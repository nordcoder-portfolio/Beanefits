{
	"info": {
		"_postman_id": "c5e3e7e9-c3c0-4244-9995-4168f92624f4",
		"name": "Coffee Loyalty Service API",
		"description": "MVP loyalty backend for a coffee shop.\n",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json",
		"_exporter_id": "40740605"
	},
	"item": [
		{
			"name": "healthz",
			"item": [
				{
					"name": "Liveness probe",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": "{{baseUrl}}/healthz"
					},
					"response": [
						{
							"name": "OK",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json"
									},
									{
										"key": "Authorization",
										"value": "Bearer <token>",
										"description": "Added as a part of security scheme: bearer"
									}
								],
								"url": "{{baseUrl}}/healthz"
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"status\": \"ok\"\n}"
						}
					]
				}
			]
		},
		{
			"name": "readyz",
			"item": [
				{
					"name": "Readiness probe (DB connectivity)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": "{{baseUrl}}/readyz"
					},
					"response": [
						{
							"name": "Ready",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json"
									},
									{
										"key": "Authorization",
										"value": "Bearer <token>",
										"description": "Added as a part of security scheme: bearer"
									}
								],
								"url": "{{baseUrl}}/readyz"
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"status\": \"ok\"\n}"
						},
						{
							"name": "Not ready",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/problem+json"
									},
									{
										"key": "Authorization",
										"value": "Bearer <token>",
										"description": "Added as a part of security scheme: bearer"
									}
								],
								"url": "{{baseUrl}}/readyz"
							},
							"status": "Service Unavailable",
							"code": 503,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/problem+json"
								}
							],
							"cookie": [],
							"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
						}
					]
				}
			]
		},
		{
			"name": "metrics",
			"item": [
				{
					"name": "Prometheus metrics endpoint",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "text/plain"
							}
						],
						"url": "{{baseUrl}}/metrics"
					},
					"response": [
						{
							"name": "Prometheus text format",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "text/plain"
									},
									{
										"key": "Authorization",
										"value": "Bearer <token>",
										"description": "Added as a part of security scheme: bearer"
									}
								],
								"url": "{{baseUrl}}/metrics"
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "text",
							"header": [
								{
									"key": "Content-Type",
									"value": "text/plain"
								}
							],
							"cookie": [],
							"body": "string"
						}
					]
				}
			]
		},
		{
			"name": "auth",
			"item": [
				{
					"name": "register",
					"item": [
						{
							"name": "Register client (phone + password)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"phone\": \"+79000000000\",\n  \"password\": \"string\"\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": "{{baseUrl}}/auth/register"
							},
							"response": [
								{
									"name": "Registered",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phone\": \"+79000000000\",\n  \"password\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/auth/register"
									},
									"status": "Created",
									"code": 201,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"user\": {\n    \"id\": 10,\n    \"phone\": \"+79000000000\",\n    \"roles\": [\n      \"CLIENT\"\n    ],\n    \"isActive\": true,\n    \"createdAt\": \"2025-12-14T10:00:00Z\"\n  },\n  \"account\": {\n    \"id\": 55,\n    \"publicCode\": \"ABCD-1234-XYZ\",\n    \"balancePoints\": 0,\n    \"totalSpendMoney\": \"0.00\",\n    \"levelCode\": \"Green Bean\",\n    \"createdAt\": \"2025-12-14T10:00:00Z\"\n  }\n}"
								},
								{
									"name": "Phone already exists",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phone\": \"+79000000000\",\n  \"password\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/auth/register"
									},
									"status": "Conflict",
									"code": 409,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Validation error",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phone\": \"+79000000000\",\n  \"password\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/auth/register"
									},
									"status": "Unprocessable Entity (WebDAV) (RFC 4918)",
									"code": 422,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						}
					]
				},
				{
					"name": "login",
					"item": [
						{
							"name": "Login (phone + password)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"phone\": \"+79000000000\",\n  \"password\": \"string\"\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": "{{baseUrl}}/auth/login"
							},
							"response": [
								{
									"name": "Logged in",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phone\": \"+79000000000\",\n  \"password\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/auth/login"
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"user\": {\n    \"id\": 10,\n    \"phone\": \"+79000000000\",\n    \"roles\": [\n      \"CLIENT\"\n    ],\n    \"isActive\": true,\n    \"createdAt\": \"2025-12-14T10:00:00Z\"\n  },\n  \"account\": {\n    \"id\": 55,\n    \"publicCode\": \"ABCD-1234-XYZ\",\n    \"balancePoints\": 0,\n    \"totalSpendMoney\": \"0.00\",\n    \"levelCode\": \"Green Bean\",\n    \"createdAt\": \"2025-12-14T10:00:00Z\"\n  }\n}"
								},
								{
									"name": "Invalid credentials",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phone\": \"+79000000000\",\n  \"password\": \"string\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/auth/login"
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						}
					]
				}
			]
		},
		{
			"name": "me",
			"item": [
				{
					"name": "balance",
					"item": [
						{
							"name": "Get current client balance",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"url": "{{baseUrl}}/me/balance",
								"description": "CLIENT only."
							},
							"response": [
								{
									"name": "Balance",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": "{{baseUrl}}/me/balance"
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"accountId\": 4501,\n  \"balancePoints\": 7424,\n  \"totalSpendMoney\": \"12500.50\",\n  \"levelCode\": \"Medium Roast\",\n  \"asOf\": \"2010-02-11T11:11:38.501Z\"\n}"
								},
								{
									"name": "Unauthorized",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": "{{baseUrl}}/me/balance"
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Forbidden",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": "{{baseUrl}}/me/balance"
									},
									"status": "Forbidden",
									"code": 403,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						}
					]
				},
				{
					"name": "events",
					"item": [
						{
							"name": "Get client events (history)",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/me/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"me",
										"events"
									],
									"query": [
										{
											"key": "limit",
											"value": "20"
										},
										{
											"key": "beforeTs",
											"value": "1967-02-09T10:17:07.448Z",
											"description": "Return events with ts < beforeTs (for pagination)"
										}
									]
								},
								"description": "CLIENT only. Returns newest first."
							},
							"response": [
								{
									"name": "Events page",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "beforeTs",
													"value": "1967-02-09T10:17:07.448Z",
													"description": "Return events with ts < beforeTs (for pagination)"
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"items\": [\n    {\n      \"id\": 7003,\n      \"accountId\": 9004,\n      \"type\": \"EARN\",\n      \"deltaPoints\": 9572,\n      \"balanceAfter\": 412,\n      \"ts\": \"2014-12-23T08:19:29.765Z\",\n      \"amountMoney\": \"450.00\",\n      \"rulesetId\": 8024,\n      \"actorUserId\": 3234\n    },\n    {\n      \"id\": 2295,\n      \"accountId\": 1836,\n      \"type\": \"SPEND\",\n      \"deltaPoints\": 5282,\n      \"balanceAfter\": 3111,\n      \"ts\": \"1948-03-26T14:16:14.769Z\",\n      \"amountMoney\": \"450.00\",\n      \"rulesetId\": 7567,\n      \"actorUserId\": 2270\n    }\n  ],\n  \"nextBeforeTs\": \"1999-08-25T10:23:04.661Z\"\n}"
								},
								{
									"name": "Unauthorized",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "beforeTs",
													"value": "1967-02-09T10:17:07.448Z",
													"description": "Return events with ts < beforeTs (for pagination)"
												}
											]
										}
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Forbidden",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "beforeTs",
													"value": "1967-02-09T10:17:07.448Z",
													"description": "Return events with ts < beforeTs (for pagination)"
												}
											]
										}
									},
									"status": "Forbidden",
									"code": 403,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						}
					]
				},
				{
					"name": "Get current client profile (including public code for QR)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"url": "{{baseUrl}}/me",
						"description": "CLIENT only."
					},
					"response": [
						{
							"name": "Profile",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json"
									},
									{
										"key": "Authorization",
										"value": "Bearer <token>",
										"description": "Added as a part of security scheme: bearer"
									}
								],
								"url": "{{baseUrl}}/me"
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n  \"user\": {\n    \"id\": 2179,\n    \"phone\": \"+79000000000\",\n    \"roles\": [\n      \"CASHIER\",\n      \"CASHIER\"\n    ],\n    \"isActive\": true,\n    \"createdAt\": \"1959-12-07T03:12:24.803Z\"\n  },\n  \"account\": {\n    \"id\": 1125,\n    \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"balancePoints\": 6992,\n    \"totalSpendMoney\": \"12500.50\",\n    \"levelCode\": \"Medium Roast\",\n    \"createdAt\": \"1993-09-18T05:28:27.955Z\"\n  }\n}"
						},
						{
							"name": "Unauthorized",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/problem+json"
									},
									{
										"key": "Authorization",
										"value": "Bearer <token>",
										"description": "Added as a part of security scheme: bearer"
									}
								],
								"url": "{{baseUrl}}/me"
							},
							"status": "Unauthorized",
							"code": 401,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/problem+json"
								}
							],
							"cookie": [],
							"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
						},
						{
							"name": "Forbidden",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/problem+json"
									},
									{
										"key": "Authorization",
										"value": "Bearer <token>",
										"description": "Added as a part of security scheme: bearer"
									}
								],
								"url": "{{baseUrl}}/me"
							},
							"status": "Forbidden",
							"code": 403,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/problem+json"
								}
							],
							"cookie": [],
							"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
						}
					]
				}
			]
		},
		{
			"name": "cashier",
			"item": [
				{
					"name": "accounts",
					"item": [
						{
							"name": "by-code",
							"item": [
								{
									"name": "{publicCode}",
									"item": [
										{
											"name": "events",
											"item": [
												{
													"name": "Get account events by public code",
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "application/json"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"cashier",
																"accounts",
																"by-code",
																":publicCode",
																"events"
															],
															"query": [
																{
																	"key": "limit",
																	"value": "20"
																},
																{
																	"key": "beforeTs",
																	"value": "1967-02-09T10:17:07.448Z",
																	"description": "Return events with ts < beforeTs (for pagination)"
																}
															],
															"variable": [
																{
																	"key": "publicCode",
																	"value": "550e8400-e29b-41d4-a716-446655440000"
																}
															]
														},
														"description": "CASHIER only. Returns newest first."
													},
													"response": [
														{
															"name": "Events page",
															"originalRequest": {
																"method": "GET",
																"header": [
																	{
																		"key": "Accept",
																		"value": "application/json"
																	},
																	{
																		"key": "Authorization",
																		"value": "Bearer <token>",
																		"description": "Added as a part of security scheme: bearer"
																	}
																],
																"url": {
																	"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
																	"host": [
																		"{{baseUrl}}"
																	],
																	"path": [
																		"cashier",
																		"accounts",
																		"by-code",
																		":publicCode",
																		"events"
																	],
																	"query": [
																		{
																			"key": "limit",
																			"value": "20"
																		},
																		{
																			"key": "beforeTs",
																			"value": "1967-02-09T10:17:07.448Z",
																			"description": "Return events with ts < beforeTs (for pagination)"
																		}
																	],
																	"variable": [
																		{
																			"key": "publicCode",
																			"value": "550e8400-e29b-41d4-a716-446655440000"
																		}
																	]
																}
															},
															"status": "OK",
															"code": 200,
															"_postman_previewlanguage": "json",
															"header": [
																{
																	"key": "Content-Type",
																	"value": "application/json"
																}
															],
															"cookie": [],
															"body": "{\n  \"items\": [\n    {\n      \"id\": 7003,\n      \"accountId\": 9004,\n      \"type\": \"EARN\",\n      \"deltaPoints\": 9572,\n      \"balanceAfter\": 412,\n      \"ts\": \"2014-12-23T08:19:29.765Z\",\n      \"amountMoney\": \"450.00\",\n      \"rulesetId\": 8024,\n      \"actorUserId\": 3234\n    },\n    {\n      \"id\": 2295,\n      \"accountId\": 1836,\n      \"type\": \"SPEND\",\n      \"deltaPoints\": 5282,\n      \"balanceAfter\": 3111,\n      \"ts\": \"1948-03-26T14:16:14.769Z\",\n      \"amountMoney\": \"450.00\",\n      \"rulesetId\": 7567,\n      \"actorUserId\": 2270\n    }\n  ],\n  \"nextBeforeTs\": \"1999-08-25T10:23:04.661Z\"\n}"
														},
														{
															"name": "Unauthorized",
															"originalRequest": {
																"method": "GET",
																"header": [
																	{
																		"key": "Accept",
																		"value": "application/problem+json"
																	},
																	{
																		"key": "Authorization",
																		"value": "Bearer <token>",
																		"description": "Added as a part of security scheme: bearer"
																	}
																],
																"url": {
																	"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
																	"host": [
																		"{{baseUrl}}"
																	],
																	"path": [
																		"cashier",
																		"accounts",
																		"by-code",
																		":publicCode",
																		"events"
																	],
																	"query": [
																		{
																			"key": "limit",
																			"value": "20"
																		},
																		{
																			"key": "beforeTs",
																			"value": "1967-02-09T10:17:07.448Z",
																			"description": "Return events with ts < beforeTs (for pagination)"
																		}
																	],
																	"variable": [
																		{
																			"key": "publicCode",
																			"value": "550e8400-e29b-41d4-a716-446655440000"
																		}
																	]
																}
															},
															"status": "Unauthorized",
															"code": 401,
															"_postman_previewlanguage": "json",
															"header": [
																{
																	"key": "Content-Type",
																	"value": "application/problem+json"
																}
															],
															"cookie": [],
															"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
														},
														{
															"name": "Forbidden",
															"originalRequest": {
																"method": "GET",
																"header": [
																	{
																		"key": "Accept",
																		"value": "application/problem+json"
																	},
																	{
																		"key": "Authorization",
																		"value": "Bearer <token>",
																		"description": "Added as a part of security scheme: bearer"
																	}
																],
																"url": {
																	"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
																	"host": [
																		"{{baseUrl}}"
																	],
																	"path": [
																		"cashier",
																		"accounts",
																		"by-code",
																		":publicCode",
																		"events"
																	],
																	"query": [
																		{
																			"key": "limit",
																			"value": "20"
																		},
																		{
																			"key": "beforeTs",
																			"value": "1967-02-09T10:17:07.448Z",
																			"description": "Return events with ts < beforeTs (for pagination)"
																		}
																	],
																	"variable": [
																		{
																			"key": "publicCode",
																			"value": "550e8400-e29b-41d4-a716-446655440000"
																		}
																	]
																}
															},
															"status": "Forbidden",
															"code": 403,
															"_postman_previewlanguage": "json",
															"header": [
																{
																	"key": "Content-Type",
																	"value": "application/problem+json"
																}
															],
															"cookie": [],
															"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
														},
														{
															"name": "Not Found",
															"originalRequest": {
																"method": "GET",
																"header": [
																	{
																		"key": "Accept",
																		"value": "application/problem+json"
																	},
																	{
																		"key": "Authorization",
																		"value": "Bearer <token>",
																		"description": "Added as a part of security scheme: bearer"
																	}
																],
																"url": {
																	"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode/events?limit=20&beforeTs=1967-02-09T10:17:07.448Z",
																	"host": [
																		"{{baseUrl}}"
																	],
																	"path": [
																		"cashier",
																		"accounts",
																		"by-code",
																		":publicCode",
																		"events"
																	],
																	"query": [
																		{
																			"key": "limit",
																			"value": "20"
																		},
																		{
																			"key": "beforeTs",
																			"value": "1967-02-09T10:17:07.448Z",
																			"description": "Return events with ts < beforeTs (for pagination)"
																		}
																	],
																	"variable": [
																		{
																			"key": "publicCode",
																			"value": "550e8400-e29b-41d4-a716-446655440000"
																		}
																	]
																}
															},
															"status": "Not Found",
															"code": 404,
															"_postman_previewlanguage": "json",
															"header": [
																{
																	"key": "Content-Type",
																	"value": "application/problem+json"
																}
															],
															"cookie": [],
															"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
														}
													]
												}
											]
										},
										{
											"name": "Lookup account by public code (QR payload)",
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "application/json"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"cashier",
														"accounts",
														"by-code",
														":publicCode"
													],
													"variable": [
														{
															"key": "publicCode",
															"value": "550e8400-e29b-41d4-a716-446655440000"
														}
													]
												},
												"description": "CASHIER only. Used by POS to resolve customer by QR/publicCode."
											},
											"response": [
												{
													"name": "Account summary",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "application/json"
															},
															{
																"key": "Authorization",
																"value": "Bearer <token>",
																"description": "Added as a part of security scheme: bearer"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"cashier",
																"accounts",
																"by-code",
																":publicCode"
															],
															"variable": [
																{
																	"key": "publicCode",
																	"value": "550e8400-e29b-41d4-a716-446655440000"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Content-Type",
															"value": "application/json"
														}
													],
													"cookie": [],
													"body": "{\n  \"accountId\": 8489,\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"balancePoints\": 4181,\n  \"totalSpendMoney\": \"12500.50\",\n  \"levelCode\": \"Medium Roast\"\n}"
												},
												{
													"name": "Unauthorized",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "application/problem+json"
															},
															{
																"key": "Authorization",
																"value": "Bearer <token>",
																"description": "Added as a part of security scheme: bearer"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"cashier",
																"accounts",
																"by-code",
																":publicCode"
															],
															"variable": [
																{
																	"key": "publicCode",
																	"value": "550e8400-e29b-41d4-a716-446655440000"
																}
															]
														}
													},
													"status": "Unauthorized",
													"code": 401,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Content-Type",
															"value": "application/problem+json"
														}
													],
													"cookie": [],
													"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
												},
												{
													"name": "Forbidden",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "application/problem+json"
															},
															{
																"key": "Authorization",
																"value": "Bearer <token>",
																"description": "Added as a part of security scheme: bearer"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"cashier",
																"accounts",
																"by-code",
																":publicCode"
															],
															"variable": [
																{
																	"key": "publicCode",
																	"value": "550e8400-e29b-41d4-a716-446655440000"
																}
															]
														}
													},
													"status": "Forbidden",
													"code": 403,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Content-Type",
															"value": "application/problem+json"
														}
													],
													"cookie": [],
													"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
												},
												{
													"name": "Not Found",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "Accept",
																"value": "application/problem+json"
															},
															{
																"key": "Authorization",
																"value": "Bearer <token>",
																"description": "Added as a part of security scheme: bearer"
															}
														],
														"url": {
															"raw": "{{baseUrl}}/cashier/accounts/by-code/:publicCode",
															"host": [
																"{{baseUrl}}"
															],
															"path": [
																"cashier",
																"accounts",
																"by-code",
																":publicCode"
															],
															"variable": [
																{
																	"key": "publicCode",
																	"value": "550e8400-e29b-41d4-a716-446655440000"
																}
															]
														}
													},
													"status": "Not Found",
													"code": 404,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Content-Type",
															"value": "application/problem+json"
														}
													],
													"cookie": [],
													"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
												}
											]
										}
									]
								}
							]
						}
					]
				},
				{
					"name": "earn",
					"item": [
						{
							"name": "Earn points for a purchase (idempotent)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"operationId\": \"17728cef-e5f8-4051-f6ba-e04cce7c69de\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountMoney\": \"450.00\",\n  \"ts\": \"1999-08-13T07:51:01.900Z\"\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": "{{baseUrl}}/cashier/earn",
								"description": "CASHIER only. Idempotent by (publicCode + operationId). Ruleset is selected by request.ts (or server time if omitted), non-retroactive. Points formula: basePoints = floor(amountMoney / baseRubPerPoint) levelPercent = percentEarn for current level (determined by totalSpendMoney before this purchase) points = floor(basePoints * (levelPercent / 100.0))\n"
							},
							"response": [
								{
									"name": "Earn applied or returned from idempotency cache",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"17728cef-e5f8-4051-f6ba-e04cce7c69de\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountMoney\": \"450.00\",\n  \"ts\": \"1999-08-13T07:51:01.900Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"operationId\": \"f574204c-e26a-0c55-35c9-6eeb4cf5e36d\",\n  \"opType\": \"SPEND\",\n  \"event\": {\n    \"id\": 9157,\n    \"accountId\": 9006,\n    \"type\": \"SPEND\",\n    \"deltaPoints\": 3506,\n    \"balanceAfter\": 6080,\n    \"ts\": \"1946-06-08T03:54:05.133Z\",\n    \"amountMoney\": \"450.00\",\n    \"rulesetId\": 3917,\n    \"actorUserId\": 3412\n  },\n  \"balance\": {\n    \"accountId\": 9598,\n    \"balancePoints\": 3981,\n    \"totalSpendMoney\": \"12500.50\",\n    \"levelCode\": \"Medium Roast\",\n    \"asOf\": \"2025-02-12T11:00:43.997Z\"\n  },\n  \"idempotentReplay\": false\n}"
								},
								{
									"name": "Unauthorized",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"17728cef-e5f8-4051-f6ba-e04cce7c69de\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountMoney\": \"450.00\",\n  \"ts\": \"1999-08-13T07:51:01.900Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Forbidden",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"17728cef-e5f8-4051-f6ba-e04cce7c69de\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountMoney\": \"450.00\",\n  \"ts\": \"1999-08-13T07:51:01.900Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"status": "Forbidden",
									"code": 403,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Account not found by publicCode",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"17728cef-e5f8-4051-f6ba-e04cce7c69de\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountMoney\": \"450.00\",\n  \"ts\": \"1999-08-13T07:51:01.900Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"status": "Not Found",
									"code": 404,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Validation error",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"17728cef-e5f8-4051-f6ba-e04cce7c69de\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountMoney\": \"450.00\",\n  \"ts\": \"1999-08-13T07:51:01.900Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"status": "Unprocessable Entity (WebDAV) (RFC 4918)",
									"code": 422,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						}
					]
				},
				{
					"name": "spend",
					"item": [
						{
							"name": "Spend points (idempotent, concurrency-safe)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"operationId\": \"8e29ee79-60b7-6973-f22a-00226d57c85f\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountPoints\": 7661,\n  \"ts\": \"1959-06-07T21:15:07.465Z\"\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": "{{baseUrl}}/cashier/spend",
								"description": "CASHIER only. Idempotent by (publicCode + operationId). If amountPoints > current balance -> 409 (no changes). Concurrent spend requests: only one can succeed if they would make balance negative.\n"
							},
							"response": [
								{
									"name": "Spend applied or returned from idempotency cache",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"8e29ee79-60b7-6973-f22a-00226d57c85f\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountPoints\": 7661,\n  \"ts\": \"1959-06-07T21:15:07.465Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/spend"
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"operationId\": \"f574204c-e26a-0c55-35c9-6eeb4cf5e36d\",\n  \"opType\": \"SPEND\",\n  \"event\": {\n    \"id\": 9157,\n    \"accountId\": 9006,\n    \"type\": \"SPEND\",\n    \"deltaPoints\": 3506,\n    \"balanceAfter\": 6080,\n    \"ts\": \"1946-06-08T03:54:05.133Z\",\n    \"amountMoney\": \"450.00\",\n    \"rulesetId\": 3917,\n    \"actorUserId\": 3412\n  },\n  \"balance\": {\n    \"accountId\": 9598,\n    \"balancePoints\": 3981,\n    \"totalSpendMoney\": \"12500.50\",\n    \"levelCode\": \"Medium Roast\",\n    \"asOf\": \"2025-02-12T11:00:43.997Z\"\n  },\n  \"idempotentReplay\": false\n}"
								},
								{
									"name": "Unauthorized",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"8e29ee79-60b7-6973-f22a-00226d57c85f\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountPoints\": 7661,\n  \"ts\": \"1959-06-07T21:15:07.465Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/spend"
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Forbidden",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"8e29ee79-60b7-6973-f22a-00226d57c85f\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountPoints\": 7661,\n  \"ts\": \"1959-06-07T21:15:07.465Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/spend"
									},
									"status": "Forbidden",
									"code": 403,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Account not found by publicCode",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"8e29ee79-60b7-6973-f22a-00226d57c85f\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountPoints\": 7661,\n  \"ts\": \"1959-06-07T21:15:07.465Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/spend"
									},
									"status": "Not Found",
									"code": 404,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Not enough balance",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"8e29ee79-60b7-6973-f22a-00226d57c85f\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountPoints\": 7661,\n  \"ts\": \"1959-06-07T21:15:07.465Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/spend"
									},
									"status": "Conflict",
									"code": 409,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Validation error",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"8e29ee79-60b7-6973-f22a-00226d57c85f\",\n  \"publicCode\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"amountPoints\": 7661,\n  \"ts\": \"1959-06-07T21:15:07.465Z\"\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/spend"
									},
									"status": "Unprocessable Entity (WebDAV) (RFC 4918)",
									"code": 422,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						}
					]
				}
			]
		},
		{
			"name": "admin",
			"item": [
				{
					"name": "users",
					"item": [
						{
							"name": "{userId}",
							"item": [
								{
									"name": "Delete (deactivate) user",
									"request": {
										"method": "DELETE",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/admin/users/:userId",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users",
												":userId"
											],
											"variable": [
												{
													"key": "userId",
													"value": "236"
												}
											]
										},
										"description": "ADMIN only. Recommended implementation: soft-delete (set is_active=false) to preserve event history.\n"
									},
									"response": [
										{
											"name": "Deleted (deactivated)",
											"originalRequest": {
												"method": "DELETE",
												"header": [
													{
														"key": "Authorization",
														"value": "Bearer <token>",
														"description": "Added as a part of security scheme: bearer"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/admin/users/:userId",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"admin",
														"users",
														":userId"
													],
													"variable": [
														{
															"key": "userId",
															"value": "236"
														}
													]
												}
											},
											"status": "No Content",
											"code": 204,
											"_postman_previewlanguage": "text",
											"header": [],
											"cookie": [],
											"body": ""
										},
										{
											"name": "Unauthorized",
											"originalRequest": {
												"method": "DELETE",
												"header": [
													{
														"key": "Accept",
														"value": "application/problem+json"
													},
													{
														"key": "Authorization",
														"value": "Bearer <token>",
														"description": "Added as a part of security scheme: bearer"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/admin/users/:userId",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"admin",
														"users",
														":userId"
													],
													"variable": [
														{
															"key": "userId",
															"value": "236"
														}
													]
												}
											},
											"status": "Unauthorized",
											"code": 401,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/problem+json"
												}
											],
											"cookie": [],
											"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
										},
										{
											"name": "Forbidden",
											"originalRequest": {
												"method": "DELETE",
												"header": [
													{
														"key": "Accept",
														"value": "application/problem+json"
													},
													{
														"key": "Authorization",
														"value": "Bearer <token>",
														"description": "Added as a part of security scheme: bearer"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/admin/users/:userId",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"admin",
														"users",
														":userId"
													],
													"variable": [
														{
															"key": "userId",
															"value": "236"
														}
													]
												}
											},
											"status": "Forbidden",
											"code": 403,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/problem+json"
												}
											],
											"cookie": [],
											"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
										},
										{
											"name": "Not Found",
											"originalRequest": {
												"method": "DELETE",
												"header": [
													{
														"key": "Accept",
														"value": "application/problem+json"
													},
													{
														"key": "Authorization",
														"value": "Bearer <token>",
														"description": "Added as a part of security scheme: bearer"
													}
												],
												"url": {
													"raw": "{{baseUrl}}/admin/users/:userId",
													"host": [
														"{{baseUrl}}"
													],
													"path": [
														"admin",
														"users",
														":userId"
													],
													"variable": [
														{
															"key": "userId",
															"value": "236"
														}
													]
												}
											},
											"status": "Not Found",
											"code": 404,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/problem+json"
												}
											],
											"cookie": [],
											"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
										}
									]
								}
							]
						},
						{
							"name": "List users",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/admin/users?limit=20&offset=0&q=string",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"admin",
										"users"
									],
									"query": [
										{
											"key": "limit",
											"value": "20"
										},
										{
											"key": "offset",
											"value": "0"
										},
										{
											"key": "q",
											"value": "string",
											"description": "Search by phone substring"
										}
									]
								},
								"description": "ADMIN only."
							},
							"response": [
								{
									"name": "Users page",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=20&offset=0&q=string",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												},
												{
													"key": "q",
													"value": "string",
													"description": "Search by phone substring"
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"items\": [\n    {\n      \"id\": 9897,\n      \"phone\": \"+79000000000\",\n      \"roles\": [\n        \"CASHIER\",\n        \"CASHIER\"\n      ],\n      \"isActive\": false,\n      \"createdAt\": \"2025-01-29T14:26:04.894Z\"\n    },\n    {\n      \"id\": 4553,\n      \"phone\": \"+79000000000\",\n      \"roles\": [\n        \"ADMIN\",\n        \"ADMIN\"\n      ],\n      \"isActive\": true,\n      \"createdAt\": \"2025-10-08T20:18:23.384Z\"\n    }\n  ],\n  \"total\": 7853\n}"
								},
								{
									"name": "Unauthorized",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=20&offset=0&q=string",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												},
												{
													"key": "q",
													"value": "string",
													"description": "Search by phone substring"
												}
											]
										}
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Forbidden",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=20&offset=0&q=string",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												},
												{
													"key": "q",
													"value": "string",
													"description": "Search by phone substring"
												}
											]
										}
									},
									"status": "Forbidden",
									"code": 403,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						}
					]
				},
				{
					"name": "rulesets",
					"item": [
						{
							"name": "current",
							"item": [
								{
									"name": "Get current ruleset (by server time)",
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/json"
											}
										],
										"url": "{{baseUrl}}/admin/rulesets/current",
										"description": "ADMIN only."
									},
									"response": [
										{
											"name": "Current ruleset",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "application/json"
													},
													{
														"key": "Authorization",
														"value": "Bearer <token>",
														"description": "Added as a part of security scheme: bearer"
													}
												],
												"url": "{{baseUrl}}/admin/rulesets/current"
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/json"
												}
											],
											"cookie": [],
											"body": "{\n  \"id\": 1264,\n  \"effectiveFrom\": \"1949-12-12T20:26:15.245Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    {\n      \"id\": 7237,\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"5000.00\",\n      \"percentEarn\": \"110.00\"\n    },\n    {\n      \"id\": 3580,\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"5000.00\",\n      \"percentEarn\": \"110.00\"\n    }\n  ],\n  \"createdAt\": \"1968-10-22T05:27:03.958Z\"\n}"
										},
										{
											"name": "Unauthorized",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "application/problem+json"
													},
													{
														"key": "Authorization",
														"value": "Bearer <token>",
														"description": "Added as a part of security scheme: bearer"
													}
												],
												"url": "{{baseUrl}}/admin/rulesets/current"
											},
											"status": "Unauthorized",
											"code": 401,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/problem+json"
												}
											],
											"cookie": [],
											"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
										},
										{
											"name": "Forbidden",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "application/problem+json"
													},
													{
														"key": "Authorization",
														"value": "Bearer <token>",
														"description": "Added as a part of security scheme: bearer"
													}
												],
												"url": "{{baseUrl}}/admin/rulesets/current"
											},
											"status": "Forbidden",
											"code": 403,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/problem+json"
												}
											],
											"cookie": [],
											"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
										},
										{
											"name": "Not Found",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "Accept",
														"value": "application/problem+json"
													},
													{
														"key": "Authorization",
														"value": "Bearer <token>",
														"description": "Added as a part of security scheme: bearer"
													}
												],
												"url": "{{baseUrl}}/admin/rulesets/current"
											},
											"status": "Not Found",
											"code": 404,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Content-Type",
													"value": "application/problem+json"
												}
											],
											"cookie": [],
											"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
										}
									]
								}
							]
						},
						{
							"name": "List rulesets (newest first)",
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"url": {
									"raw": "{{baseUrl}}/admin/rulesets?limit=20&offset=0",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"admin",
										"rulesets"
									],
									"query": [
										{
											"key": "limit",
											"value": "20"
										},
										{
											"key": "offset",
											"value": "0"
										}
									]
								},
								"description": "ADMIN only."
							},
							"response": [
								{
									"name": "Rulesets page",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=20&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"items\": [\n    {\n      \"id\": 373,\n      \"effectiveFrom\": \"1978-12-08T22:24:50.067Z\",\n      \"baseRubPerPoint\": \"10.00\",\n      \"levels\": [\n        {\n          \"id\": 3464,\n          \"levelCode\": \"Medium Roast\",\n          \"thresholdTotalSpend\": \"5000.00\",\n          \"percentEarn\": \"110.00\"\n        },\n        {\n          \"id\": 4794,\n          \"levelCode\": \"Medium Roast\",\n          \"thresholdTotalSpend\": \"5000.00\",\n          \"percentEarn\": \"110.00\"\n        }\n      ],\n      \"createdAt\": \"1948-06-01T07:07:38.734Z\"\n    },\n    {\n      \"id\": 8198,\n      \"effectiveFrom\": \"2011-06-27T03:38:09.955Z\",\n      \"baseRubPerPoint\": \"10.00\",\n      \"levels\": [\n        {\n          \"id\": 5536,\n          \"levelCode\": \"Medium Roast\",\n          \"thresholdTotalSpend\": \"5000.00\",\n          \"percentEarn\": \"110.00\"\n        },\n        {\n          \"id\": 6010,\n          \"levelCode\": \"Medium Roast\",\n          \"thresholdTotalSpend\": \"5000.00\",\n          \"percentEarn\": \"110.00\"\n        }\n      ],\n      \"createdAt\": \"1973-02-15T00:45:36.687Z\"\n    }\n  ],\n  \"total\": 8497\n}"
								},
								{
									"name": "Unauthorized",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=20&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Forbidden",
									"originalRequest": {
										"method": "GET",
										"header": [
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=20&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"status": "Forbidden",
									"code": 403,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						},
						{
							"name": "Create new ruleset (not retroactive)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Accept",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"effectiveFrom\": \"1986-09-17T22:31:29.919Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    {\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"0.00\",\n      \"percentEarn\": \"100.00\"\n    }\n  ]\n}",
									"options": {
										"raw": {
											"headerFamily": "json",
											"language": "json"
										}
									}
								},
								"url": "{{baseUrl}}/admin/rulesets",
								"description": "ADMIN only. Creates a new ruleset effective from given timestamp. Future operations use the ruleset selected by operation ts.\n"
							},
							"response": [
								{
									"name": "Created ruleset",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"1986-09-17T22:31:29.919Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    {\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"0.00\",\n      \"percentEarn\": \"100.00\"\n    }\n  ]\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"status": "Created",
									"code": 201,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/json"
										}
									],
									"cookie": [],
									"body": "{\n  \"id\": 1264,\n  \"effectiveFrom\": \"1949-12-12T20:26:15.245Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    {\n      \"id\": 7237,\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"5000.00\",\n      \"percentEarn\": \"110.00\"\n    },\n    {\n      \"id\": 3580,\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"5000.00\",\n      \"percentEarn\": \"110.00\"\n    }\n  ],\n  \"createdAt\": \"1968-10-22T05:27:03.958Z\"\n}"
								},
								{
									"name": "Unauthorized",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"1986-09-17T22:31:29.919Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    {\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"0.00\",\n      \"percentEarn\": \"100.00\"\n    }\n  ]\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"status": "Unauthorized",
									"code": 401,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Forbidden",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"1986-09-17T22:31:29.919Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    {\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"0.00\",\n      \"percentEarn\": \"100.00\"\n    }\n  ]\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"status": "Forbidden",
									"code": 403,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "ruleset.effectiveFrom already exists",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"1986-09-17T22:31:29.919Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    {\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"0.00\",\n      \"percentEarn\": \"100.00\"\n    }\n  ]\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"status": "Conflict",
									"code": 409,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								},
								{
									"name": "Validation error",
									"originalRequest": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/problem+json"
											},
											{
												"key": "Authorization",
												"value": "Bearer <token>",
												"description": "Added as a part of security scheme: bearer"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"1986-09-17T22:31:29.919Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    {\n      \"levelCode\": \"Medium Roast\",\n      \"thresholdTotalSpend\": \"0.00\",\n      \"percentEarn\": \"100.00\"\n    }\n  ]\n}",
											"options": {
												"raw": {
													"headerFamily": "json",
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"status": "Unprocessable Entity (WebDAV) (RFC 4918)",
									"code": 422,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Content-Type",
											"value": "application/problem+json"
										}
									],
									"cookie": [],
									"body": "{\n  \"type\": \"about:blank\",\n  \"title\": \"Validation error\",\n  \"status\": 422,\n  \"detail\": \"phone: invalid format\",\n  \"instance\": \"/cashier/spend\",\n  \"code\": \"NOT_ENOUGH_BALANCE\"\n}"
								}
							]
						}
					]
				}
			]
		},
		{
			"name": "tests",
			"item": [
				{
					"name": "00_setup",
					"item": [
						{
							"name": "Login as Admin",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status is 200\", () => pm.response.to.have.status(200));",
											"",
											"const response = pm.response.json();",
											"pm.environment.unset(\"adminToken\");",
											"pm.environment.set(\"adminToken\", response.accessToken);"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"phone\": \"{{adminPhone}}\", \"password\": \"{{testPassword}}\"}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "{{baseUrl}}/auth/login",
								"description": "Authenticate as admin user and store adminToken"
							},
							"response": []
						},
						{
							"name": "Login as Cashier",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status is 200\", () => pm.response.to.have.status(200));",
											"",
											"const response = pm.response.json();",
											"pm.environment.unset(\"cashierToken\");",
											"pm.environment.set(\"cashierToken\", response.accessToken);"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"phone\": \"{{cashierPhone}}\", \"password\": \"{{testPassword}}\"}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "{{baseUrl}}/auth/login",
								"description": "Authenticate as cashier user and store cashierToken"
							},
							"response": []
						},
						{
							"name": "Login as Client",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status is 200\", () => pm.response.to.have.status(200));",
											"",
											"const response = pm.response.json();",
											"pm.environment.unset(\"clientToken\");",
											"pm.environment.set(\"clientToken\", response.accessToken);",
											"pm.environment.set(\"clientPublicCode\", response.account.publicCode);"
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"phone\": \"{{clientPhone}}\", \"password\": \"{{testPassword}}\"}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": "{{baseUrl}}/auth/login",
								"description": "Authenticate as client user and store clientToken and clientPublicCode"
							},
							"response": []
						}
					]
				},
				{
					"name": "10_health",
					"item": [
						{
							"name": "healthz",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 200\", () => {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", () => {\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\")\r",
											"    .to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"pm.test(\"Body.status == ok\", () => {\r",
											"  var data = pm.response.json();\r",
											"  pm.expect(data).to.have.property(\"status\");\r",
											"  pm.expect(String(data.status).toLowerCase()).to.eql(\"ok\");\r",
											"});\r",
											"\r",
											"pm.test(\"Response time < 2000ms\", () => {\r",
											"  pm.expect(pm.response.responseTime).to.be.below(2000);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": "{{baseUrl}}/healthz"
							},
							"response": []
						},
						{
							"name": "readyz",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status 200 (service ready)\", () => {\r",
											"  pm.response.to.have.status(200);\r",
											"});\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", () => {\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\")\r",
											"    .to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"pm.test(\"Body.status == ok\", () => {\r",
											"  var data = pm.response.json();\r",
											"  pm.expect(data).to.have.property(\"status\");\r",
											"  pm.expect(String(data.status).toLowerCase()).to.eql(\"ok\");\r",
											"});\r",
											"\r",
											"pm.test(\"Response time < 2000ms\", () => {\r",
											"  pm.expect(pm.response.responseTime).to.be.below(2000);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": "{{baseUrl}}/readyz"
							},
							"response": []
						}
					]
				},
				{
					"name": "20_auth",
					"item": [
						{
							"name": "register",
							"item": [
								{
									"name": "00 Register random",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"function randDigits(n) {\r",
													"  let s = \"\";\r",
													"  for (let i = 0; i < n; i++) s += Math.floor(Math.random() * 10);\r",
													"  return s;\r",
													"}\r",
													"\r",
													"const phone = \"+79\" + randDigits(9);\r",
													"const password = \"Passw0rd!\" + randDigits(4);\r",
													"\r",
													"pm.collectionVariables.set(\"regPhone\", phone);\r",
													"pm.collectionVariables.set(\"regPassword\", password);\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										},
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"201 Created\", () => pm.response.to.have.status(201));\r",
													"\r",
													"pm.test(\"Content-Type is JSON\", () => {\r",
													"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\")\r",
													"    .to.include(\"application/json\");\r",
													"});\r",
													"\r",
													"var data = pm.response.json();\r",
													"\r",
													"pm.test(\"AuthResponse has accessToken and user\", () => {\r",
													"  pm.expect(data).to.have.property(\"accessToken\");\r",
													"  pm.expect(data.accessToken).to.be.a(\"string\").and.not.empty;\r",
													"\r",
													"  pm.expect(data).to.have.property(\"user\");\r",
													"  pm.expect(data.user).to.be.an(\"object\");\r",
													"});\r",
													"\r",
													"pm.test(\"User is CLIENT and active\", () => {\r",
													"  pm.expect(data.user.roles).to.be.an(\"array\");\r",
													"  pm.expect(data.user.roles).to.include(\"CLIENT\");\r",
													"  pm.expect(data.user.isActive).to.eql(true);\r",
													"});\r",
													"\r",
													"pm.collectionVariables.set(\"regToken\", data.accessToken);\r",
													"pm.collectionVariables.set(\"regUserId\", String(data.user.id));\r",
													"\r",
													"if (data.account) {\r",
													"  pm.collectionVariables.set(\"regAccountId\", String(data.account.id));\r",
													"  pm.collectionVariables.set(\"regPublicCode\", String(data.account.publicCode));\r",
													"}\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "noauth"
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\r\n  \"phone\": \"{{regPhone}}\",\r\n  \"password\": \"{{regPassword}}\"\r\n}"
										},
										"url": "{{baseUrl}}/auth/register"
									},
									"response": []
								},
								{
									"name": "10 CheckMe",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));\r",
													"\r",
													"var data = pm.response.json();\r",
													"\r",
													"pm.test(\"/me returns user and account\", () => {\r",
													"  pm.expect(data).to.have.property(\"user\");\r",
													"  pm.expect(data).to.have.property(\"account\");\r",
													"});\r",
													"\r",
													"pm.test(\"user.id matches registered userId\", () => {\r",
													"  const expected = pm.collectionVariables.get(\"regUserId\");\r",
													"  pm.expect(String(data.user.id)).to.eql(String(expected));\r",
													"});\r",
													"\r",
													"pm.collectionVariables.set(\"regAccountId\", String(data.account.id));\r",
													"pm.collectionVariables.set(\"regPublicCode\", String(data.account.publicCode));\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{regToken}}"
											}
										},
										"method": "GET",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": ""
										},
										"url": "{{baseUrl}}/me"
									},
									"response": []
								},
								{
									"name": "20 Cleanup",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"204 No Content\", () => pm.response.to.have.status(204));\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "DELETE",
										"header": [],
										"url": "{{baseUrl}}/admin/users/{{regUserId}}"
									},
									"response": []
								},
								{
									"name": "30 Login deactivated",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Login fails after deactivation (403 expected)\", () => {\r",
													"  pm.expect([403]).to.include(pm.response.code);\r",
													"});\r",
													""
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											},
											{
												"key": "Accept",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phone\": \"{{regPhone}}\",\n  \"password\": \"{{regPassword}}\"\n}"
										},
										"url": "{{baseUrl}}/auth/login"
									},
									"response": []
								}
							]
						},
						{
							"name": "Admin Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"200 OK\", () => pm.response.to.have.status(200));\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", () => {\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\")\r",
											"    .to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var data = pm.response.json();\r",
											"\r",
											"pm.test(\"AuthResponse has accessToken and user\", () => {\r",
											"  pm.expect(data).to.have.property(\"accessToken\");\r",
											"  pm.expect(data.accessToken).to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"  pm.expect(data).to.have.property(\"user\");\r",
											"  pm.expect(data.user).to.be.an(\"object\");\r",
											"});\r",
											"\r",
											"pm.test(\"accessToken looks like JWT\", () => {\r",
											"  const parts = String(data.accessToken).split(\".\");\r",
											"  pm.expect(parts.length).to.eql(3);\r",
											"  pm.expect(parts[0]).to.not.be.empty;\r",
											"  pm.expect(parts[1]).to.not.be.empty;\r",
											"  pm.expect(parts[2]).to.not.be.empty;\r",
											"});\r",
											"\r",
											"pm.test(\"User has required fields\", () => {\r",
											"  const u = data.user;\r",
											"  pm.expect(u).to.have.property(\"id\");\r",
											"  pm.expect(u).to.have.property(\"phone\");\r",
											"  pm.expect(u).to.have.property(\"roles\");\r",
											"  pm.expect(u).to.have.property(\"isActive\");\r",
											"  pm.expect(u).to.have.property(\"createdAt\");\r",
											"\r",
											"  pm.expect(u.roles).to.be.an(\"array\");\r",
											"  pm.expect(u.isActive).to.eql(true);\r",
											"});\r",
											"\r",
											"pm.test(\"User has ADMIN role\", () => {\r",
											"  pm.expect(data.user.roles).to.include(\"ADMIN\");\r",
											"});\r",
											"\r",
											"pm.environment.unset(\"adminToken\")\r",
											"pm.environment.set(\"adminToken\", data.accessToken);\r",
											"\r",
											"pm.environment.set(\"adminUserId\", String(data.user.id));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"phone\": \"{{adminPhone}}\", \"password\": \"{{testPassword}}\"}"
								},
								"url": "{{baseUrl}}/auth/login"
							},
							"response": []
						},
						{
							"name": "Cashier Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"200 OK\", () => pm.response.to.have.status(200));\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", () => {\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\")\r",
											"    .to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var data = pm.response.json();\r",
											"\r",
											"pm.test(\"AuthResponse has accessToken and user\", () => {\r",
											"  pm.expect(data).to.have.property(\"accessToken\");\r",
											"  pm.expect(data.accessToken).to.be.a(\"string\").and.not.empty;\r",
											"  pm.expect(data).to.have.property(\"user\");\r",
											"});\r",
											"\r",
											"pm.test(\"User has CASHIER role\", () => {\r",
											"  pm.expect(data.user.roles).to.be.an(\"array\");\r",
											"  pm.expect(data.user.roles).to.include(\"CASHIER\");\r",
											"  pm.expect(data.user.isActive).to.eql(true);\r",
											"});\r",
											"\r",
											"pm.environment.unset(\"cashierToken\")\r",
											"pm.environment.set(\"cashierToken\", data.accessToken);\r",
											"\r",
											"pm.environment.set(\"cashierUserId\", String(data.user.id));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"phone\": \"{{cashierPhone}}\", \"password\": \"{{testPassword}}\"}"
								},
								"url": "{{baseUrl}}/auth/login"
							},
							"response": []
						},
						{
							"name": "Client Login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"200 OK\", () => pm.response.to.have.status(200));\r",
											"\r",
											"pm.test(\"Content-Type is JSON\", () => {\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\")\r",
											"    .to.include(\"application/json\");\r",
											"});\r",
											"\r",
											"var data = pm.response.json();\r",
											"\r",
											"pm.test(\"AuthResponse has accessToken and user\", () => {\r",
											"  pm.expect(data).to.have.property(\"accessToken\");\r",
											"  pm.expect(data.accessToken).to.be.a(\"string\").and.not.empty;\r",
											"\r",
											"  pm.expect(data).to.have.property(\"user\");\r",
											"  pm.expect(data.user.roles).to.be.an(\"array\");\r",
											"  pm.expect(data.user.roles).to.include(\"CLIENT\");\r",
											"  pm.expect(data.user.isActive).to.eql(true);\r",
											"});\r",
											"\r",
											"pm.environment.unset(\"clientToken\")\r",
											"pm.environment.set(\"clientToken\", data.accessToken);\r",
											"\r",
											"if (data.account) {\r",
											"  pm.test(\"Account has required fields\", () => {\r",
											"    pm.expect(data.account).to.have.property(\"id\");\r",
											"    pm.expect(data.account).to.have.property(\"publicCode\");\r",
											"    pm.expect(data.account).to.have.property(\"balancePoints\");\r",
											"    pm.expect(data.account).to.have.property(\"totalSpendMoney\");\r",
											"    pm.expect(data.account).to.have.property(\"levelCode\");\r",
											"    pm.expect(data.account).to.have.property(\"createdAt\");\r",
											"  });\r",
											"\r",
											"  pm.environment.set(\"clientAccountId\", String(data.account.id));\r",
											"  pm.environment.set(\"publicCode\", String(data.account.publicCode)); //       \r",
											"} else {\r",
											"  console.warn(\"AuthResponse.account is missing; will need /me to obtain publicCode.\");\r",
											"}\r",
											"\r",
											"pm.environment.set(\"clientAccountId\", String(data.user.id));\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"phone\": \"{{clientPhone}}\", \"password\": \"{{testPassword}}\"}"
								},
								"url": "{{baseUrl}}/auth/login"
							},
							"response": []
						},
						{
							"name": "Client Login WrongPassword",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"401 Unauthorized\", () => pm.response.to.have.status(401));\r",
											"\r",
											"pm.test(\"Content-Type is problem+json\", () => {\r",
											"  pm.expect(pm.response.headers.get(\"Content-Type\") || \"\")\r",
											"    .to.include(\"application/problem+json\");\r",
											"});\r",
											"\r",
											"const p = pm.response.json();\r",
											"\r",
											"pm.test(\"Problem has required fields\", () => {\r",
											"  pm.expect(p).to.have.property(\"type\");\r",
											"  pm.expect(p).to.have.property(\"title\");\r",
											"  pm.expect(p).to.have.property(\"status\");\r",
											"  pm.expect(p.status).to.eql(401);\r",
											"});\r",
											""
										],
										"type": "text/javascript",
										"packages": {},
										"requests": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\"phone\": \"{{clientPhone}}\", \"password\": \"{{testPassword}}_WRONG\"}"
								},
								"url": "{{baseUrl}}/auth/login"
							},
							"response": []
						}
					]
				},
				{
					"name": "30_cashier",
					"item": [
						{
							"name": "Earn",
							"item": [
								{
									"name": "20.1 Cashier - Account summary (before earn) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.test(\"Has balancePoints and totalSpendMoney\", () => {",
													"  pm.expect(data).to.have.property('balancePoints');",
													"  pm.expect(data).to.have.property('totalSpendMoney');",
													"});",
													"pm.collectionVariables.set('earnBalanceBefore', String(data.balancePoints));",
													"function moneyToCents(str) {",
													"  const s = String(str).trim();",
													"  const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"  pm.expect(m, `Invalid money format: ${s}`).to.not.eql(null);",
													"  const rub = m[1];",
													"  const kop = (m[2] || '').padEnd(2, '0');",
													"  return (BigInt(rub) * 100n + BigInt(kop));",
													"}",
													"pm.collectionVariables.set('earnSpendBeforeCents', moneyToCents(data.totalSpendMoney).toString());"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/cashier/accounts/by-code/{{publicCode}}"
									},
									"response": []
								},
								{
									"name": "20.2 Cashier - Earn (success) Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.collectionVariables.set('earnOperationId', pm.variables.replaceIn('{{$guid}}'));",
													"pm.collectionVariables.set('earnAmountMoney', '500.00');",
													"function moneyToCents(str) {",
													"  const s = String(str).trim();",
													"  const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"  if (!m) throw new Error('Invalid money format: ' + s);",
													"  const rub = m[1];",
													"  const kop = (m[2] || '').padEnd(2, '0');",
													"  return (BigInt(rub) * 100n + BigInt(kop));",
													"}",
													"const spendBefore = BigInt(pm.collectionVariables.get('earnSpendBeforeCents') || '0');",
													"const amount = moneyToCents(pm.collectionVariables.get('earnAmountMoney'));",
													"pm.collectionVariables.set('earnExpectedSpendAfterCents', (spendBefore + amount).toString());"
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"const res = pm.response.json();",
													"pm.test(\"opType/event.type = EARN\", () => {",
													"  pm.expect(res.opType).to.eql('EARN');",
													"  pm.expect(res.event.type).to.eql('EARN');",
													"});",
													"pm.test(\"deltaPoints > 0\", () => {",
													"  pm.expect(res.event.deltaPoints).to.be.a('number');",
													"  pm.expect(Number.isInteger(res.event.deltaPoints)).to.eql(true);",
													"  pm.expect(res.event.deltaPoints).to.be.above(0);",
													"});",
													"const before = parseInt(pm.collectionVariables.get('earnBalanceBefore') || '0', 10);",
													"const after = res.balance.balancePoints;",
													"const delta = res.event.deltaPoints;",
													"pm.test(\"after == before + delta\", () => {",
													"  pm.expect(after).to.eql(before + delta);",
													"});",
													"pm.test(\"event.balanceAfter == balance.balancePoints\", () => {",
													"  pm.expect(res.event.balanceAfter).to.eql(res.balance.balancePoints);",
													"});",
													"function moneyToCents(str) {",
													"  const s = String(str).trim();",
													"  const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"  pm.expect(m, `Invalid money format: ${s}`).to.not.eql(null);",
													"  const rub = m[1];",
													"  const kop = (m[2] || '').padEnd(2, '0');",
													"  return (BigInt(rub) * 100n + BigInt(kop));",
													"}",
													"pm.test(\"totalSpendMoney increased by amountMoney\", () => {",
													"  const expected = BigInt(pm.collectionVariables.get('earnExpectedSpendAfterCents'));",
													"  const got = moneyToCents(res.balance.totalSpendMoney);",
													"  pm.expect(got.toString()).to.eql(expected.toString());",
													"});",
													"pm.collectionVariables.set('earnEventId', String(res.event.id));",
													"pm.collectionVariables.set('earnBalanceAfter', String(res.balance.balancePoints));"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"{{earnOperationId}}\",\n  \"publicCode\": \"{{publicCode}}\",\n  \"amountMoney\": \"{{earnAmountMoney}}\"\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"response": []
								},
								{
									"name": "20.3 Cashier - Earn (idempotent replay) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"const res = pm.response.json();",
													"const prevEventId = pm.collectionVariables.get('earnEventId');",
													"const prevBalance = parseInt(pm.collectionVariables.get('earnBalanceAfter'), 10);",
													"pm.test(\"same event.id\", () => {",
													"  pm.expect(String(res.event.id)).to.eql(String(prevEventId));",
													"});",
													"pm.test(\"balance unchanged\", () => {",
													"  pm.expect(res.balance.balancePoints).to.eql(prevBalance);",
													"  pm.expect(res.event.balanceAfter).to.eql(prevBalance);",
													"});",
													"if (typeof res.idempotentReplay !== 'undefined') {",
													"  pm.test('idempotentReplay == true', () => pm.expect(res.idempotentReplay).to.eql(true));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"{{earnOperationId}}\",\n  \"publicCode\": \"{{publicCode}}\",\n  \"amountMoney\": \"{{earnAmountMoney}}\"\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"response": []
								},
								{
									"name": "20.4 Cashier - Earn (404 unknown publicCode) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"404 Not Found\", () => pm.response.to.have.status(404));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 500', () => pm.expect(p.status).to.eql(404));"
												],
												"type": "text/javascript",
												"packages": {},
												"requests": {}
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"{{$guid}}\",\n  \"publicCode\": \"550e8400-e29b-41d4-a321-446655440000\",\n  \"amountMoney\": \"500.00\"\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"response": []
								}
							]
						},
						{
							"name": "Spend",
							"item": [
								{
									"name": "21.1 Cashier - Earn (top-up for spend suite) Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.collectionVariables.set('spendTopupOperationId', pm.variables.replaceIn('{{$guid}}'));",
													"pm.collectionVariables.set('spendTopupAmountMoney', '100000.00');"
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"const res = pm.response.json();",
													"pm.test('opType=EARN', () => pm.expect(res.opType).to.eql('EARN'));",
													"pm.test('balancePoints present', () => {",
													"  pm.expect(res.balance).to.have.property('balancePoints');",
													"  pm.expect(res.balance.balancePoints).to.be.a('number');",
													"  pm.expect(res.balance.balancePoints).to.be.at.least(0);",
													"});",
													"pm.collectionVariables.set('spendBalanceAfterTopup', String(res.balance.balancePoints));"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"{{spendTopupOperationId}}\",\n  \"publicCode\": \"{{publicCode}}\",\n  \"amountMoney\": \"{{spendTopupAmountMoney}}\"\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/earn"
									},
									"response": []
								},
								{
									"name": "21.2 Cashier - Account summary (before spend) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.test('Has balancePoints and totalSpendMoney', () => {",
													"  pm.expect(data).to.have.property('balancePoints');",
													"  pm.expect(data).to.have.property('totalSpendMoney');",
													"});",
													"pm.test('balancePoints is non-negative int', () => {",
													"  pm.expect(data.balancePoints).to.be.a('number');",
													"  pm.expect(data.balancePoints).to.be.at.least(0);",
													"  pm.expect(Number.isInteger(data.balancePoints)).to.eql(true);",
													"});",
													"pm.collectionVariables.set('spendBalanceBefore', String(data.balancePoints));",
													"function moneyToCents(str) {",
													"  const s = String(str).trim();",
													"  const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"  pm.expect(m, `Invalid money format: ${s}`).to.not.eql(null);",
													"  const rub = m[1];",
													"  const kop = (m[2] || '').padEnd(2, '0');",
													"  return (BigInt(rub) * 100n + BigInt(kop));",
													"}",
													"pm.collectionVariables.set('spendTotalSpendBeforeCents', moneyToCents(data.totalSpendMoney).toString());"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/cashier/accounts/by-code/{{publicCode}}"
									},
									"response": []
								},
								{
									"name": "21.3 Cashier - Spend (success) Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const before = parseInt(pm.collectionVariables.get('spendBalanceBefore') || '0', 10);",
													"const safe = Math.max(1, Math.min(10, Math.floor(before / 2) || 1));",
													"pm.collectionVariables.set('spendAmountPoints', String(safe));",
													"pm.collectionVariables.set('spendOperationId', pm.variables.replaceIn('{{$guid}}'));",
													"pm.collectionVariables.set('spendExpectedAfter', String(before - safe));"
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"const res = pm.response.json();",
													"const amount = parseInt(pm.collectionVariables.get('spendAmountPoints'), 10);",
													"const before = parseInt(pm.collectionVariables.get('spendBalanceBefore'), 10);",
													"const expectedAfter = parseInt(pm.collectionVariables.get('spendExpectedAfter'), 10);",
													"pm.test('opType/event.type = SPEND', () => {",
													"  pm.expect(res.opType).to.eql('SPEND');",
													"  pm.expect(res.event.type).to.eql('SPEND');",
													"});",
													"pm.test('deltaPoints == -amountPoints', () => {",
													"  pm.expect(res.event.deltaPoints).to.eql(-amount);",
													"});",
													"pm.test('after == before - amount', () => {",
													"  pm.expect(res.balance.balancePoints).to.eql(before - amount);",
													"  pm.expect(res.event.balanceAfter).to.eql(before - amount);",
													"});",
													"pm.test('event.balanceAfter matches balance.balancePoints', () => {",
													"  pm.expect(res.event.balanceAfter).to.eql(res.balance.balancePoints);",
													"});",
													"function moneyToCents(str) {",
													"  const s = String(str).trim();",
													"  const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"  pm.expect(m, `Invalid money format: ${s}`).to.not.eql(null);",
													"  const rub = m[1];",
													"  const kop = (m[2] || '').padEnd(2, '0');",
													"  return (BigInt(rub) * 100n + BigInt(kop));",
													"}",
													"pm.test('totalSpendMoney unchanged on spend', () => {",
													"  const expected = BigInt(pm.collectionVariables.get('spendTotalSpendBeforeCents'));",
													"  const got = moneyToCents(res.balance.totalSpendMoney);",
													"  pm.expect(got.toString()).to.eql(expected.toString());",
													"});",
													"pm.collectionVariables.set('spendEventId', String(res.event.id));",
													"pm.collectionVariables.set('spendBalanceAfter', String(res.balance.balancePoints));",
													"pm.collectionVariables.set('spendTotalSpendAfterCents', moneyToCents(res.balance.totalSpendMoney).toString());",
													"pm.test('expectedAfter matches', () => pm.expect(res.balance.balancePoints).to.eql(expectedAfter));"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"{{spendOperationId}}\",\n  \"publicCode\": \"{{publicCode}}\",\n  \"amountPoints\": {{spendAmountPoints}}\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/spend"
									},
									"response": []
								},
								{
									"name": "21.4 Cashier - Spend (idempotent replay) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"const res = pm.response.json();",
													"const prevEventId = pm.collectionVariables.get('spendEventId');",
													"const prevBalance = parseInt(pm.collectionVariables.get('spendBalanceAfter'), 10);",
													"pm.test('same event.id on replay', () => {",
													"  pm.expect(String(res.event.id)).to.eql(String(prevEventId));",
													"});",
													"pm.test('balance unchanged on replay', () => {",
													"  pm.expect(res.balance.balancePoints).to.eql(prevBalance);",
													"  pm.expect(res.event.balanceAfter).to.eql(prevBalance);",
													"});",
													"if (typeof res.idempotentReplay !== 'undefined') {",
													"  pm.test('idempotentReplay == true', () => pm.expect(res.idempotentReplay).to.eql(true));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"operationId\": \"{{spendOperationId}}\",\n  \"publicCode\": \"{{publicCode}}\",\n  \"amountPoints\": {{spendAmountPoints}}\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/cashier/spend"
									},
									"response": []
								}
							]
						}
					]
				},
				{
					"name": "40_client",
					"item": [
						{
							"name": "balance",
							"item": [
								{
									"name": "30.1 Client - GET /me/balance (200) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"pm.test(\"Content-Type is JSON\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/json');",
													"});",
													"var data = pm.response.json();",
													"pm.test(\"Has required fields\", () => {",
													"  pm.expect(data).to.have.property('accountId');",
													"  pm.expect(data).to.have.property('balancePoints');",
													"  pm.expect(data).to.have.property('totalSpendMoney');",
													"  pm.expect(data).to.have.property('levelCode');",
													"  pm.expect(data).to.have.property('asOf');",
													"});",
													"pm.test(\"balancePoints is non-negative int\", () => {",
													"  pm.expect(data.balancePoints).to.be.a('number');",
													"  pm.expect(Number.isInteger(data.balancePoints)).to.eql(true);",
													"  pm.expect(data.balancePoints).to.be.at.least(0);",
													"});",
													"pm.test(\"totalSpendMoney is decimal string\", () => {",
													"  const s = String(data.totalSpendMoney);",
													"  pm.expect(s).to.match(/^\\d+(?:\\.\\d{1,2})?$/);",
													"});",
													"pm.test(\"asOf is parseable datetime\", () => {",
													"  const t = Date.parse(String(data.asOf));",
													"  pm.expect(Number.isNaN(t)).to.eql(false);",
													"});",
													"pm.collectionVariables.set('meAccountId', String(data.accountId));",
													"pm.collectionVariables.set('meBalancePoints', String(data.balancePoints));",
													"pm.collectionVariables.set('meTotalSpendMoney', String(data.totalSpendMoney));",
													"pm.collectionVariables.set('meLevelCode', String(data.levelCode));",
													"pm.collectionVariables.set('meAsOf', String(data.asOf));",
													"function moneyToCents(str) {",
													"  const s = String(str).trim();",
													"  const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"  pm.expect(m, `Invalid money format: ${s}`).to.not.eql(null);",
													"  const rub = m[1];",
													"  const kop = (m[2] || '').padEnd(2, '0');",
													"  return (BigInt(rub) * 100n + BigInt(kop));",
													"}",
													"pm.collectionVariables.set('meTotalSpendCents', moneyToCents(data.totalSpendMoney).toString());",
													"const acctBal = pm.collectionVariables.get('acctBalancePoints');",
													"if (acctBal !== undefined && acctBal !== null && String(acctBal).length > 0) {",
													"  pm.test('Optional: /me/balance equals cashier account balance', () => {",
													"    pm.expect(String(data.balancePoints)).to.eql(String(acctBal));",
													"  });",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/me/balance"
									},
									"response": []
								},
								{
									"name": "30.2 Client - GET /me/balance (401 no token) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"401 Unauthorized\", () => pm.response.to.have.status(401));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 401', () => pm.expect(p.status).to.eql(401));"
												]
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/me/balance"
									},
									"response": []
								},
								{
									"name": "30.3 Cashier - GET /me/balance (RBAC check; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const code = pm.response.code;",
													"if (code === 403) {",
													"  pm.test('403 Forbidden', () => pm.expect(code).to.eql(403));",
													"} else if (code === 200) {",
													"  pm.test('RBAC WARNING: cashier can access /me/balance (200)', () => pm.expect(true).to.eql(true));",
													"  console.warn('RBAC WARNING: cashier token received 200 on /me/balance; check roles/logic');",
													"} else {",
													"  pm.test('Unexpected status (expected 403, tolerated 200)', () => pm.expect([200,403]).to.include(code));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/me/balance"
									},
									"response": []
								},
								{
									"name": "30.4 Admin - GET /me/balance (RBAC check; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const code = pm.response.code;",
													"if (code === 403) {",
													"  pm.test('403 Forbidden', () => pm.expect(code).to.eql(403));",
													"} else if (code === 200) {",
													"  pm.test('RBAC WARNING: admin can access /me/balance (200)', () => pm.expect(true).to.eql(true));",
													"  console.warn('RBAC WARNING: admin token received 200 on /me/balance; check roles/logic');",
													"} else {",
													"  pm.test('Unexpected status (expected 403, tolerated 200)', () => pm.expect([200,403]).to.include(code));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/me/balance"
									},
									"response": []
								}
							]
						},
						{
							"name": "me",
							"item": [
								{
									"name": "29.1 Client - GET /me (200) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"pm.test(\"Content-Type is JSON\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/json');",
													"});",
													"var data = pm.response.json();",
													"pm.test(\"Has user and account\", () => {",
													"  pm.expect(data).to.have.property('user');",
													"  pm.expect(data).to.have.property('account');",
													"});",
													"pm.test(\"User fields are present\", () => {",
													"  const u = data.user;",
													"  pm.expect(u).to.have.property('id');",
													"  pm.expect(u).to.have.property('phone');",
													"  pm.expect(u).to.have.property('roles');",
													"  pm.expect(u).to.have.property('isActive');",
													"  pm.expect(u).to.have.property('createdAt');",
													"  pm.expect(u.roles).to.be.an('array');",
													"});",
													"pm.test(\"User is active\", () => {",
													"  pm.expect(data.user.isActive).to.eql(true);",
													"});",
													"pm.test(\"User has CLIENT role\", () => {",
													"  pm.expect(data.user.roles).to.include('CLIENT');",
													"});",
													"pm.test(\"Account fields are present\", () => {",
													"  const a = data.account;",
													"  pm.expect(a).to.have.property('id');",
													"  pm.expect(a).to.have.property('publicCode');",
													"  pm.expect(a).to.have.property('balancePoints');",
													"  pm.expect(a).to.have.property('totalSpendMoney');",
													"  pm.expect(a).to.have.property('levelCode');",
													"  pm.expect(a).to.have.property('createdAt');",
													"});",
													"pm.test(\"publicCode looks like UUID\", () => {",
													"  const s = String(data.account.publicCode);",
													"  pm.expect(s).to.match(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/);",
													"});",
													"pm.test(\"balancePoints is non-negative int\", () => {",
													"  const bp = data.account.balancePoints;",
													"  pm.expect(bp).to.be.a('number');",
													"  pm.expect(Number.isInteger(bp)).to.eql(true);",
													"  pm.expect(bp).to.be.at.least(0);",
													"});",
													"pm.test(\"totalSpendMoney is decimal string\", () => {",
													"  const s = String(data.account.totalSpendMoney);",
													"  pm.expect(s).to.match(/^\\d+(?:\\.\\d{1,2})?$/);",
													"});",
													"pm.collectionVariables.set('meUserId', String(data.user.id));",
													"pm.collectionVariables.set('meUserPhone', String(data.user.phone));",
													"pm.collectionVariables.set('meAccountId', String(data.account.id));",
													"pm.collectionVariables.set('mePublicCode', String(data.account.publicCode));",
													"pm.collectionVariables.set('meBalancePointsFromMe', String(data.account.balancePoints));",
													"pm.collectionVariables.set('meTotalSpendMoneyFromMe', String(data.account.totalSpendMoney));",
													"pm.collectionVariables.set('meLevelCodeFromMe', String(data.account.levelCode));"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/me"
									},
									"response": []
								},
								{
									"name": "29.2 Client - GET /me (401 no token) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"401 Unauthorized\", () => pm.response.to.have.status(401));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 401', () => pm.expect(p.status).to.eql(401));"
												]
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/me"
									},
									"response": []
								},
								{
									"name": "29.3 Cashier - GET /me (RBAC check; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const code = pm.response.code;",
													"if (code === 403) {",
													"  pm.test('403 Forbidden', () => pm.expect(code).to.eql(403));",
													"} else if (code === 200) {",
													"  pm.test('RBAC WARNING: cashier can access /me (200)', () => pm.expect(true).to.eql(true));",
													"  console.warn('RBAC WARNING: cashier token received 200 on /me; check roles/logic');",
													"} else {",
													"  pm.test('Unexpected status (expected 403, tolerated 200)', () => pm.expect([200,403]).to.include(code));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/me"
									},
									"response": []
								},
								{
									"name": "29.4 Admin - GET /me (RBAC check; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const code = pm.response.code;",
													"if (code === 403) {",
													"  pm.test('403 Forbidden', () => pm.expect(code).to.eql(403));",
													"} else if (code === 200) {",
													"  pm.test('RBAC WARNING: admin can access /me (200)', () => pm.expect(true).to.eql(true));",
													"  console.warn('RBAC WARNING: admin token received 200 on /me; check roles/logic');",
													"} else {",
													"  pm.test('Unexpected status (expected 403, tolerated 200)', () => pm.expect([200,403]).to.include(code));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/me"
									},
									"response": []
								}
							]
						},
						{
							"name": "events",
							"item": [
								{
									"name": "31.1 Client - GET /me/events (200, newest-first if non-empty) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.test(\"Has items array\", () => {",
													"  pm.expect(data).to.have.property('items');",
													"  pm.expect(data.items).to.be.an('array');",
													"});",
													"if (data.items.length > 0) {",
													"  pm.test('Event items have required fields', () => {",
													"    for (const e of data.items) {",
													"      pm.expect(e).to.have.property('id');",
													"      pm.expect(e).to.have.property('accountId');",
													"      pm.expect(e).to.have.property('type');",
													"      pm.expect(e).to.have.property('deltaPoints');",
													"      pm.expect(e).to.have.property('balanceAfter');",
													"      pm.expect(e).to.have.property('ts');",
													"    }",
													"  });",
													"  pm.test('Events are newest-first by ts', () => {",
													"    for (let i = 1; i < data.items.length; i++) {",
													"      const prev = Date.parse(data.items[i - 1].ts);",
													"      const cur = Date.parse(data.items[i].ts);",
													"      pm.expect(Number.isNaN(prev)).to.eql(false);",
													"      pm.expect(Number.isNaN(cur)).to.eql(false);",
													"      pm.expect(prev).to.be.at.least(cur);",
													"    }",
													"  });",
													"}",
													"if (Object.prototype.hasOwnProperty.call(data, 'nextBeforeTs')) {",
													"  pm.collectionVariables.set('meEventsNextBeforeTs', data.nextBeforeTs === null ? '' : String(data.nextBeforeTs));",
													"} else {",
													"  pm.collectionVariables.set('meEventsNextBeforeTs', '');",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=20",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "31.2 Client - GET /me/events (page 1, limit=1) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.expect(data.items).to.be.an('array');",
													"if (data.items.length > 0) {",
													"  const e0 = data.items[0];",
													"  pm.collectionVariables.set('meEventsFirstId', String(e0.id));",
													"  pm.collectionVariables.set('meEventsFirstTs', String(e0.ts));",
													"} else {",
													"  pm.collectionVariables.set('meEventsFirstId', '');",
													"  pm.collectionVariables.set('meEventsFirstTs', '');",
													"}",
													"if (Object.prototype.hasOwnProperty.call(data, 'nextBeforeTs') && data.nextBeforeTs) {",
													"  pm.collectionVariables.set('meEventsNextBeforeTs', String(data.nextBeforeTs));",
													"} else {",
													"  pm.collectionVariables.set('meEventsNextBeforeTs', '');",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=1",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "31.3 Client - GET /me/events (page 2, using beforeTs) Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const n = String(pm.collectionVariables.get('meEventsNextBeforeTs') || '');",
													"const active = n.length > 0;",
													"pm.collectionVariables.set('meEventsPaginationActive', active ? '1' : '0');",
													"pm.collectionVariables.set('meEventsBeforeTsParam', active ? n : '1970-01-01T00:00:00Z');"
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"const active = pm.collectionVariables.get('meEventsPaginationActive') === '1';",
													"var data = pm.response.json();",
													"pm.expect(data.items).to.be.an('array');",
													"if (!active) {",
													"  pm.test('Pagination not available (no nextBeforeTs) - shape ok', () => pm.expect(true).to.eql(true));",
													"} else {",
													"  const firstTs = String(pm.collectionVariables.get('meEventsFirstTs') || '');",
													"  const firstId = String(pm.collectionVariables.get('meEventsFirstId') || '');",
													"  if (!firstTs || !firstId) {",
													"    pm.test('Page1 had no items; cannot assert page2 ordering - ok', () => pm.expect(true).to.eql(true));",
													"  } else if (data.items.length === 0) {",
													"    pm.test('Page2 empty (only one event total) - ok', () => pm.expect(true).to.eql(true));",
													"  } else {",
													"    const e0 = data.items[0];",
													"    pm.test('Page2 event is older than page1 event', () => {",
													"      const t1 = Date.parse(firstTs);",
													"      const t2 = Date.parse(e0.ts);",
													"      pm.expect(Number.isNaN(t1)).to.eql(false);",
													"      pm.expect(Number.isNaN(t2)).to.eql(false);",
													"      pm.expect(t1).to.be.above(t2);",
													"    });",
													"    pm.test('Page2 event differs from page1 event', () => {",
													"      pm.expect(String(e0.id)).to.not.eql(firstId);",
													"    });",
													"  }",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=1&beforeTs={{meEventsBeforeTsParam}}",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "beforeTs",
													"value": "{{meEventsBeforeTsParam}}"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "31.4 Client - GET /me/events (401 no token) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"401 Unauthorized\", () => pm.response.to.have.status(401));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 401', () => pm.expect(p.status).to.eql(401));"
												]
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=1",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "31.6 Cashier - GET /me/events (RBAC check; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const code = pm.response.code;",
													"if (code === 403) {",
													"  pm.test('403 Forbidden', () => pm.expect(code).to.eql(403));",
													"} else if (code === 200) {",
													"  pm.test('RBAC WARNING: cashier can access /me/events (200)', () => pm.expect(true).to.eql(true));",
													"  console.warn('RBAC WARNING: cashier token received 200 on /me/events; check roles/logic');",
													"} else {",
													"  pm.test('Unexpected status (expected 403, tolerated 200)', () => pm.expect([200,403]).to.include(code));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=1",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "31.7 Admin - GET /me/events (RBAC check; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const code = pm.response.code;",
													"if (code === 403) {",
													"  pm.test('403 Forbidden', () => pm.expect(code).to.eql(403));",
													"} else if (code === 200) {",
													"  pm.test('RBAC WARNING: admin can access /me/events (200)', () => pm.expect(true).to.eql(true));",
													"  console.warn('RBAC WARNING: admin token received 200 on /me/events; check roles/logic');",
													"} else {",
													"  pm.test('Unexpected status (expected 403, tolerated 200)', () => pm.expect([200,403]).to.include(code));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/me/events?limit=1",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"me",
												"events"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												}
											]
										}
									},
									"response": []
								}
							]
						}
					]
				},
				{
					"name": "50_admin",
					"item": [
						{
							"name": "deactivate",
							"item": [
								{
									"name": "50.1 Auth - Register temp client (for deactivation) Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													"function randDigits(n) {",
													"  let s = '';",
													"  for (let i = 0; i < n; i++) s += Math.floor(Math.random() * 10);",
													"  return s;",
													"}",
													"const phone = '+79' + randDigits(9);",
													"const password = 'Passw0rd!' + randDigits(4);",
													"pm.collectionVariables.set('admTmpPhone', phone);",
													"pm.collectionVariables.set('admTmpPassword', password);"
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"201 Created\", () => pm.response.to.have.status(201));",
													"pm.test(\"Content-Type is JSON\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/json');",
													"});",
													"var data = pm.response.json();",
													"pm.test('AuthResponse has accessToken and user', () => {",
													"  pm.expect(data).to.have.property('accessToken');",
													"  pm.expect(data.accessToken).to.be.a('string').and.not.empty;",
													"  pm.expect(data).to.have.property('user');",
													"});",
													"pm.test('User is CLIENT and active', () => {",
													"  pm.expect(data.user.roles).to.be.an('array');",
													"  pm.expect(data.user.roles).to.include('CLIENT');",
													"  pm.expect(data.user.isActive).to.eql(true);",
													"});",
													"pm.collectionVariables.set('admTmpUserId', String(data.user.id));",
													"pm.collectionVariables.set('admTmpToken', String(data.accessToken));"
												]
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phone\": \"{{admTmpPhone}}\",\n  \"password\": \"{{admTmpPassword}}\"\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/auth/register"
									},
									"response": []
								},
								{
									"name": "50.2 Admin - DELETE /admin/users/{userId} (204) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"204 No Content\", () => pm.response.to.have.status(204));"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "DELETE",
										"header": [],
										"url": "{{baseUrl}}/admin/users/{{admTmpUserId}}"
									},
									"response": []
								},
								{
									"name": "50.3 Auth - Login temp client after deactivation (should fail) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Login is denied after deactivation (401/403)', () => {",
													"  pm.expect([401, 403]).to.include(pm.response.code);",
													"});",
													"if (pm.response.code === 401 || pm.response.code === 403) {",
													"  const ct = pm.response.headers.get('Content-Type') || '';",
													"  pm.test('problem+json content-type', () => pm.expect(ct).to.include('application/problem+json'));",
													"  const p = pm.response.json();",
													"  pm.test('Problem.status matches', () => pm.expect(p.status).to.eql(pm.response.code));",
													"}"
												]
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"phone\": \"{{admTmpPhone}}\",\n  \"password\": \"{{admTmpPassword}}\"\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/auth/login"
									},
									"response": []
								},
								{
									"name": "50.4 Admin - DELETE same user again (expect 404; tolerate 204) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Second delete returns 404 (or 204 if idempotent)', () => {",
													"  pm.expect([404, 204]).to.include(pm.response.code);",
													"});",
													"if (pm.response.code === 404) {",
													"  const ct = pm.response.headers.get('Content-Type') || '';",
													"  pm.test('problem+json content-type', () => pm.expect(ct).to.include('application/problem+json'));",
													"  const p = pm.response.json();",
													"  pm.test('Problem.status == 404', () => pm.expect(p.status).to.eql(404));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "DELETE",
										"header": [],
										"url": "{{baseUrl}}/admin/users/{{admTmpUserId}}"
									},
									"response": []
								},
								{
									"name": "50.6 Cashier - DELETE /admin/users/{userId} (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for cashier (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "DELETE",
										"header": [],
										"url": "{{baseUrl}}/admin/users/{{admTmpUserId}}"
									},
									"response": []
								},
								{
									"name": "50.7 Admin - GET /admin/users?q=phone (expect inactive or absent) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.test('Has items array', () => {",
													"  pm.expect(data).to.have.property('items');",
													"  pm.expect(data.items).to.be.an('array');",
													"});",
													"const uid = String(pm.collectionVariables.get('admTmpUserId') || '');",
													"const matches = data.items.filter(u => String(u.id) === uid);",
													"if (matches.length === 0) {",
													"  pm.test('User not returned by search (acceptable for hard-delete)', () => pm.expect(true).to.eql(true));",
													"} else {",
													"  pm.test('User isActive == false after deactivation', () => {",
													"    pm.expect(matches[0]).to.have.property('isActive');",
													"    pm.expect(matches[0].isActive).to.eql(false);",
													"  });",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=20&offset=0&q={{admTmpPhone}}",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												},
												{
													"key": "q",
													"value": "{{admTmpPhone}}"
												}
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "listusers",
							"item": [
								{
									"name": "51.1 Admin - GET /admin/users (200) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.test('Has items array', () => {",
													"  pm.expect(data).to.have.property('items');",
													"  pm.expect(data.items).to.be.an('array');",
													"});",
													"if (Object.prototype.hasOwnProperty.call(data, 'total') && data.total !== null) {",
													"  pm.test('Optional total is integer', () => {",
													"    pm.expect(data.total).to.be.a('number');",
													"    pm.expect(Number.isInteger(data.total)).to.eql(true);",
													"    pm.expect(data.total).to.be.at.least(0);",
													"  });",
													"}",
													"pm.test('Each user has required fields', () => {",
													"  for (const u of data.items) {",
													"    pm.expect(u).to.have.property('id');",
													"    pm.expect(u).to.have.property('phone');",
													"    pm.expect(u).to.have.property('roles');",
													"    pm.expect(u).to.have.property('isActive');",
													"    pm.expect(u).to.have.property('createdAt');",
													"    pm.expect(u.roles).to.be.an('array');",
													"  }",
													"});",
													"if (data.items.length > 0) {",
													"  pm.collectionVariables.set('adminUsersFirstId', String(data.items[0].id));",
													"  pm.collectionVariables.set('adminUsersFirstPhone', String(data.items[0].phone));",
													"} else {",
													"  pm.collectionVariables.set('adminUsersFirstId', '');",
													"  pm.collectionVariables.set('adminUsersFirstPhone', '');",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=20&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "51.2 Admin - GET /admin/users (page 1, limit=1) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.expect(data.items).to.be.an('array');",
													"if (data.items.length > 0) {",
													"  pm.collectionVariables.set('adminUsersP1Id', String(data.items[0].id));",
													"  pm.collectionVariables.set('adminUsersP1Phone', String(data.items[0].phone));",
													"} else {",
													"  pm.collectionVariables.set('adminUsersP1Id', '');",
													"  pm.collectionVariables.set('adminUsersP1Phone', '');",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=1&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "51.3 Admin - GET /admin/users (page 2, limit=1, offset=1) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.expect(data.items).to.be.an('array');",
													"const p1id = String(pm.collectionVariables.get('adminUsersP1Id') || '');",
													"if (!p1id) {",
													"  pm.test('Page1 empty; cannot assert pagination distinctness - ok', () => pm.expect(true).to.eql(true));",
													"} else if (data.items.length === 0) {",
													"  pm.test('Page2 empty (only one user total) - ok', () => pm.expect(true).to.eql(true));",
													"} else {",
													"  pm.test('Page2 user differs from page1 user', () => {",
													"    pm.expect(String(data.items[0].id)).to.not.eql(p1id);",
													"  });",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=1&offset=1",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "1"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "51.4 Admin - GET /admin/users?q=phone_substring (search) Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const phone = String(pm.collectionVariables.get('adminUsersP1Phone') || pm.collectionVariables.get('adminUsersFirstPhone') || '');",
													"if (!phone) {",
													"  // Fallback: a substring that likely matches nothing; test will allow empty result.",
													"  pm.collectionVariables.set('adminUsersQ', '000000');",
													"} else {",
													"  // Use last 4 digits (stable, avoids leading '+')",
													"  const digits = phone.replace(/\\D/g, '');",
													"  const q = digits.length >= 4 ? digits.slice(-4) : digits;",
													"  pm.collectionVariables.set('adminUsersQ', q);",
													"}"
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"const q = String(pm.collectionVariables.get('adminUsersQ') || '');",
													"pm.test('Has items array', () => {",
													"  pm.expect(data).to.have.property('items');",
													"  pm.expect(data.items).to.be.an('array');",
													"});",
													"pm.test('All returned phones contain q (digits-only match)', () => {",
													"  for (const u of data.items) {",
													"    const digits = String(u.phone || '').replace(/\\D/g, '');",
													"    pm.expect(digits.includes(q)).to.eql(true);",
													"  }",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=20&offset=0&q={{adminUsersQ}}",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												},
												{
													"key": "q",
													"value": "{{adminUsersQ}}"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "51.5 Admin - GET /admin/users?limit=101 (expect 422; tolerate 200) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const code = pm.response.code;",
													"pm.test('Status is 422 (preferred) or 200 (capped)', () => {",
													"  pm.expect([422, 200]).to.include(code);",
													"});",
													"if (code === 422) {",
													"  const ct = pm.response.headers.get('Content-Type') || '';",
													"  pm.test('problem+json', () => pm.expect(ct).to.include('application/problem+json'));",
													"  const p = pm.response.json();",
													"  pm.test('Problem.status == 422', () => pm.expect(p.status).to.eql(422));",
													"} else {",
													"  console.warn('VALIDATION WARNING: limit=101 returned 200; server may be capping limit instead of 422');",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=101&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "101"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "51.6 Admin - GET /admin/users (401 no token) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"401 Unauthorized\", () => pm.response.to.have.status(401));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 401', () => pm.expect(p.status).to.eql(401));"
												]
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=1&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "51.7 Cashier - GET /admin/users (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for cashier (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=1&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "51.8 Client - GET /admin/users (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for client (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/users?limit=1&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"users"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "currentruleset",
							"item": [
								{
									"name": "52.1 Admin - GET /admin/rulesets/current (200 or 404) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Status is 200 or 404 (depends on seed)', () => {",
													"  pm.expect([200, 404]).to.include(pm.response.code);",
													"});",
													"if (pm.response.code === 404) {",
													"  const ct = pm.response.headers.get('Content-Type') || '';",
													"  pm.test('404 -> problem+json', () => pm.expect(ct).to.include('application/problem+json'));",
													"  const p = pm.response.json();",
													"  pm.test('Problem.status == 404', () => pm.expect(p.status).to.eql(404));",
													"} else {",
													"  const ct = pm.response.headers.get('Content-Type') || '';",
													"  pm.test('200 -> JSON', () => pm.expect(ct).to.include('application/json'));",
													"  const r = pm.response.json();",
													"  pm.test('Ruleset has required fields', () => {",
													"    pm.expect(r).to.have.property('id');",
													"    pm.expect(r).to.have.property('effectiveFrom');",
													"    pm.expect(r).to.have.property('baseRubPerPoint');",
													"    pm.expect(r).to.have.property('levels');",
													"    pm.expect(r).to.have.property('createdAt');",
													"  });",
													"  pm.test('Datetime fields parseable', () => {",
													"    pm.expect(Number.isNaN(Date.parse(String(r.effectiveFrom)))).to.eql(false);",
													"    pm.expect(Number.isNaN(Date.parse(String(r.createdAt)))).to.eql(false);",
													"  });",
													"  function decToCents(str) {",
													"    const s = String(str).trim();",
													"    const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"    pm.expect(m, `Invalid decimal format: ${s}`).to.not.eql(null);",
													"    const rub = m[1];",
													"    const kop = (m[2] || '').padEnd(2, '0');",
													"    return (BigInt(rub) * 100n + BigInt(kop));",
													"  }",
													"  pm.test('baseRubPerPoint is decimal string > 0', () => {",
													"    const v = decToCents(r.baseRubPerPoint);",
													"    pm.expect(v > 0n).to.eql(true);",
													"  });",
													"  pm.test('levels is non-empty array', () => {",
													"    pm.expect(r.levels).to.be.an('array');",
													"    pm.expect(r.levels.length).to.be.at.least(1);",
													"  });",
													"  pm.test('Each LevelRule has required fields and valid decimals', () => {",
													"    const seenLevelCode = new Set();",
													"    const seenThreshold = new Set();",
													"    for (const lv of r.levels) {",
													"      pm.expect(lv).to.have.property('id');",
													"      pm.expect(lv).to.have.property('levelCode');",
													"      pm.expect(lv).to.have.property('thresholdTotalSpend');",
													"      pm.expect(lv).to.have.property('percentEarn');",
													"      // uniqueness expectations (your DB schema suggests unique per ruleset)",
													"      const lc = String(lv.levelCode);",
													"      const th = String(lv.thresholdTotalSpend);",
													"      pm.expect(seenLevelCode.has(lc)).to.eql(false);",
													"      pm.expect(seenThreshold.has(th)).to.eql(false);",
													"      seenLevelCode.add(lc);",
													"      seenThreshold.add(th);",
													"      // validate decimals (>=0 for threshold, >0 for percentEarn)",
													"      const thCents = decToCents(lv.thresholdTotalSpend);",
													"      pm.expect(thCents >= 0n).to.eql(true);",
													"      const pct = decToCents(lv.percentEarn);",
													"      pm.expect(pct > 0n).to.eql(true);",
													"    }",
													"  });",
													"  // Optional: check thresholds are sorted ascending (not mandated, but nice if true). Tolerant.",
													"  try {",
													"    const ths = r.levels.map(lv => decToCents(lv.thresholdTotalSpend));",
													"    let sorted = true;",
													"    for (let i = 1; i < ths.length; i++) if (ths[i] < ths[i-1]) sorted = false;",
													"    if (!sorted) console.warn('NOTE: level thresholds are not sorted ascending');",
													"  } catch (e) {",
													"    console.warn('NOTE: threshold sorting check skipped:', e.message);",
													"  }",
													"  // Save for later suites",
													"  pm.collectionVariables.set('currentRulesetId', String(r.id));",
													"  pm.collectionVariables.set('currentRulesetEffectiveFrom', String(r.effectiveFrom));",
													"  pm.collectionVariables.set('currentRulesetBaseRubPerPoint', String(r.baseRubPerPoint));",
													"  pm.collectionVariables.set('currentRulesetCreatedAt', String(r.createdAt));",
													"  pm.collectionVariables.set('currentRulesetLevelsCount', String(r.levels.length));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/admin/rulesets/current"
									},
									"response": []
								},
								{
									"name": "52.2 Admin - GET /admin/rulesets/current (401 no token) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"401 Unauthorized\", () => pm.response.to.have.status(401));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 401', () => pm.expect(p.status).to.eql(401));"
												]
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/admin/rulesets/current"
									},
									"response": []
								},
								{
									"name": "52.3 Cashier - GET /admin/rulesets/current (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for cashier (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/admin/rulesets/current"
									},
									"response": []
								},
								{
									"name": "52.4 Client - GET /admin/rulesets/current (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for client (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/admin/rulesets/current"
									},
									"response": []
								}
							]
						},
						{
							"name": "listrulesets",
							"item": [
								{
									"name": "53.1 Admin - GET /admin/rulesets (200) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.test('Has items array', () => {",
													"  pm.expect(data).to.have.property('items');",
													"  pm.expect(data.items).to.be.an('array');",
													"});",
													"if (Object.prototype.hasOwnProperty.call(data, 'total') && data.total !== null) {",
													"  pm.test('Optional total is integer', () => {",
													"    pm.expect(data.total).to.be.a('number');",
													"    pm.expect(Number.isInteger(data.total)).to.eql(true);",
													"    pm.expect(data.total).to.be.at.least(0);",
													"  });",
													"}",
													"function decToCents(str) {",
													"  const s = String(str).trim();",
													"  const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"  pm.expect(m, `Invalid decimal format: ${s}`).to.not.eql(null);",
													"  const rub = m[1];",
													"  const kop = (m[2] || '').padEnd(2, '0');",
													"  return (BigInt(rub) * 100n + BigInt(kop));",
													"}",
													"pm.test('Each ruleset has required fields', () => {",
													"  for (const r of data.items) {",
													"    pm.expect(r).to.have.property('id');",
													"    pm.expect(r).to.have.property('effectiveFrom');",
													"    pm.expect(r).to.have.property('baseRubPerPoint');",
													"    pm.expect(r).to.have.property('levels');",
													"    pm.expect(r).to.have.property('createdAt');",
													"    pm.expect(r.levels).to.be.an('array');",
													"    pm.expect(Number.isNaN(Date.parse(String(r.effectiveFrom)))).to.eql(false);",
													"    pm.expect(Number.isNaN(Date.parse(String(r.createdAt)))).to.eql(false);",
													"    const base = decToCents(r.baseRubPerPoint);",
													"    pm.expect(base > 0n).to.eql(true);",
													"  }",
													"});",
													"if (data.items.length > 1) {",
													"  pm.test('Rulesets are newest-first (effectiveFrom desc)', () => {",
													"    for (let i = 1; i < data.items.length; i++) {",
													"      const prev = Date.parse(String(data.items[i - 1].effectiveFrom));",
													"      const cur = Date.parse(String(data.items[i].effectiveFrom));",
													"      pm.expect(prev).to.be.at.least(cur);",
													"    }",
													"  });",
													"}",
													"if (data.items.length > 0) {",
													"  pm.collectionVariables.set('rulesetsFirstId', String(data.items[0].id));",
													"  pm.collectionVariables.set('rulesetsCount', String(data.items.length));",
													"} else {",
													"  pm.collectionVariables.set('rulesetsFirstId', '');",
													"  pm.collectionVariables.set('rulesetsCount', '0');",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=20&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "20"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "53.2 Admin - GET /admin/rulesets (page 1, limit=1) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.expect(data.items).to.be.an('array');",
													"if (data.items.length > 0) {",
													"  pm.collectionVariables.set('rulesetsP1Id', String(data.items[0].id));",
													"} else {",
													"  pm.collectionVariables.set('rulesetsP1Id', '');",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=1&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "53.3 Admin - GET /admin/rulesets (page 2, limit=1, offset=1) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"200 OK\", () => pm.response.to.have.status(200));",
													"var data = pm.response.json();",
													"pm.expect(data.items).to.be.an('array');",
													"const p1id = String(pm.collectionVariables.get('rulesetsP1Id') || '');",
													"if (!p1id) {",
													"  pm.test('Page1 empty; cannot assert pagination distinctness - ok', () => pm.expect(true).to.eql(true));",
													"} else if (data.items.length === 0) {",
													"  pm.test('Page2 empty (only one ruleset total) - ok', () => pm.expect(true).to.eql(true));",
													"} else {",
													"  pm.test('Page2 ruleset differs from page1 ruleset', () => {",
													"    pm.expect(String(data.items[0].id)).to.not.eql(p1id);",
													"  });",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=1&offset=1",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "1"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "53.4 Admin - GET /admin/rulesets?limit=101 (expect 422; tolerate 200) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const code = pm.response.code;",
													"pm.test('Status is 422 (preferred) or 200 (capped)', () => {",
													"  pm.expect([422, 200]).to.include(code);",
													"});",
													"if (code === 422) {",
													"  const ct = pm.response.headers.get('Content-Type') || '';",
													"  pm.test('problem+json', () => pm.expect(ct).to.include('application/problem+json'));",
													"  const p = pm.response.json();",
													"  pm.test('Problem.status == 422', () => pm.expect(p.status).to.eql(422));",
													"} else {",
													"  console.warn('VALIDATION WARNING: limit=101 returned 200; server may be capping limit instead of 422');",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=101&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "101"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "53.5 Admin - GET /admin/rulesets (401 no token) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"401 Unauthorized\", () => pm.response.to.have.status(401));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 401', () => pm.expect(p.status).to.eql(401));"
												]
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=1&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "53.6 Cashier - GET /admin/rulesets (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for cashier (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=1&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "53.7 Client - GET /admin/rulesets (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for client (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{baseUrl}}/admin/rulesets?limit=1&offset=0",
											"host": [
												"{{baseUrl}}"
											],
											"path": [
												"admin",
												"rulesets"
											],
											"query": [
												{
													"key": "limit",
													"value": "1"
												},
												{
													"key": "offset",
													"value": "0"
												}
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "createruleset",
							"item": [
								{
									"name": "54.1 Admin - POST /admin/rulesets (201 create future ruleset) Copy",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													"const now = Date.now();",
													"const oneYear = 365 * 24 * 60 * 60 * 1000;",
													"const jitter = Math.floor(Math.random() * 60 * 60 * 1000); // up to 1h jitter to avoid collisions",
													"const effectiveFrom = new Date(now + oneYear + jitter).toISOString();",
													"pm.collectionVariables.set('rsEffectiveFrom', effectiveFrom);",
													"pm.collectionVariables.set('rsBaseRubPerPoint', '10.00');"
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"201 Created\", () => pm.response.to.have.status(201));",
													"pm.test(\"Content-Type is JSON\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/json');",
													"});",
													"const r = pm.response.json();",
													"pm.test('Ruleset has required fields', () => {",
													"  pm.expect(r).to.have.property('id');",
													"  pm.expect(r).to.have.property('effectiveFrom');",
													"  pm.expect(r).to.have.property('baseRubPerPoint');",
													"  pm.expect(r).to.have.property('levels');",
													"  pm.expect(r).to.have.property('createdAt');",
													"  pm.expect(r.levels).to.be.an('array');",
													"  pm.expect(r.levels.length).to.be.at.least(1);",
													"});",
													"pm.test('Returned effectiveFrom and baseRubPerPoint match request', () => {",
													"  pm.expect(String(r.effectiveFrom)).to.eql(String(pm.collectionVariables.get('rsEffectiveFrom')));",
													"  pm.expect(String(r.baseRubPerPoint)).to.eql(String(pm.collectionVariables.get('rsBaseRubPerPoint')));",
													"});",
													"pm.test('Datetime fields parseable', () => {",
													"  pm.expect(Number.isNaN(Date.parse(String(r.effectiveFrom)))).to.eql(false);",
													"  pm.expect(Number.isNaN(Date.parse(String(r.createdAt)))).to.eql(false);",
													"});",
													"function decToCents(str) {",
													"  const s = String(str).trim();",
													"  const m = s.match(/^(\\d+)(?:\\.(\\d{1,2}))?$/);",
													"  pm.expect(m, `Invalid decimal format: ${s}`).to.not.eql(null);",
													"  const rub = m[1];",
													"  const kop = (m[2] || '').padEnd(2, '0');",
													"  return (BigInt(rub) * 100n + BigInt(kop));",
													"}",
													"pm.test('levels contain valid LevelRule fields', () => {",
													"  for (const lv of r.levels) {",
													"    pm.expect(lv).to.have.property('id');",
													"    pm.expect(lv).to.have.property('levelCode');",
													"    pm.expect(lv).to.have.property('thresholdTotalSpend');",
													"    pm.expect(lv).to.have.property('percentEarn');",
													"    const th = decToCents(lv.thresholdTotalSpend);",
													"    pm.expect(th >= 0n).to.eql(true);",
													"    const pct = decToCents(lv.percentEarn);",
													"    pm.expect(pct > 0n).to.eql(true);",
													"  }",
													"});",
													"pm.collectionVariables.set('rsCreatedId', String(r.id));"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"{{rsEffectiveFrom}}\",\n  \"baseRubPerPoint\": \"{{rsBaseRubPerPoint}}\",\n  \"levels\": [\n    { \"levelCode\": \"Green Bean\", \"thresholdTotalSpend\": \"0.00\", \"percentEarn\": \"100.00\" },\n    { \"levelCode\": \"Light Roast\", \"thresholdTotalSpend\": \"5000.00\", \"percentEarn\": \"110.00\" }\n  ]\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"response": []
								},
								{
									"name": "54.3 Admin - GET /admin/rulesets/current (should not be the future ruleset) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Status is 200 or 404', () => pm.expect([200,404]).to.include(pm.response.code));",
													"if (pm.response.code === 200) {",
													"  const r = pm.response.json();",
													"  const future = String(pm.collectionVariables.get('rsEffectiveFrom'));",
													"  pm.test('Current effectiveFrom differs from created future effectiveFrom', () => {",
													"    pm.expect(String(r.effectiveFrom)).to.not.eql(future);",
													"  });",
													"} else {",
													"  pm.test('No current ruleset (404) - ok', () => pm.expect(true).to.eql(true));",
													"}"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "GET",
										"header": [],
										"url": "{{baseUrl}}/admin/rulesets/current"
									},
									"response": []
								},
								{
									"name": "54.4 Admin - POST /admin/rulesets (422 missing levels) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"422 Validation error\", () => pm.response.to.have.status(422));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 422', () => pm.expect(p.status).to.eql(422));"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"2099-01-01T00:00:00Z\",\n  \"baseRubPerPoint\": \"10.00\"\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"response": []
								},
								{
									"name": "54.5 Admin - POST /admin/rulesets (422 invalid numbers) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"422 Validation error\", () => pm.response.to.have.status(422));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 422', () => pm.expect(p.status).to.eql(422));"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{adminToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"2099-01-02T00:00:00Z\",\n  \"baseRubPerPoint\": \"0.00\",\n  \"levels\": [\n    { \"levelCode\": \"X\", \"thresholdTotalSpend\": \"0.00\", \"percentEarn\": \"0.00\" }\n  ]\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"response": []
								},
								{
									"name": "54.6 Admin - POST /admin/rulesets (401 no token) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test(\"401 Unauthorized\", () => pm.response.to.have.status(401));",
													"pm.test(\"problem+json\", () => {",
													"  pm.expect(pm.response.headers.get('Content-Type') || '').to.include('application/problem+json');",
													"});",
													"const p = pm.response.json();",
													"pm.test('Problem.status == 401', () => pm.expect(p.status).to.eql(401));"
												]
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"2099-01-03T00:00:00Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    { \"levelCode\": \"X\", \"thresholdTotalSpend\": \"0.00\", \"percentEarn\": \"100.00\" }\n  ]\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"response": []
								},
								{
									"name": "54.7 Cashier - POST /admin/rulesets (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for cashier (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{cashierToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"2099-01-04T00:00:00Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    { \"levelCode\": \"X\", \"thresholdTotalSpend\": \"0.00\", \"percentEarn\": \"100.00\" }\n  ]\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"response": []
								},
								{
									"name": "54.8 Client - POST /admin/rulesets (RBAC; expect 403) Copy",
									"event": [
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													"pm.test('Forbidden for client (403; tolerate 401)', () => {",
													"  pm.expect([403, 401]).to.include(pm.response.code);",
													"});"
												]
											}
										}
									],
									"request": {
										"auth": {
											"type": "bearer",
											"bearer": {
												"token": "{{clientToken}}"
											}
										},
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n  \"effectiveFrom\": \"2099-01-05T00:00:00Z\",\n  \"baseRubPerPoint\": \"10.00\",\n  \"levels\": [\n    { \"levelCode\": \"X\", \"thresholdTotalSpend\": \"0.00\", \"percentEarn\": \"100.00\" }\n  ]\n}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": "{{baseUrl}}/admin/rulesets"
									},
									"response": []
								}
							]
						}
					]
				},
				{
					"name": "90_security_negative",
					"item": []
				},
				{
					"name": "99_cleanup",
					"item": []
				}
			]
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": {
			"token": "{{bearerToken}}"
		}
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080"
		},
		{
			"key": "regPhone",
			"value": ""
		},
		{
			"key": "regPassword",
			"value": ""
		},
		{
			"key": "regToken",
			"value": ""
		},
		{
			"key": "regUserId",
			"value": ""
		},
		{
			"key": "regAccountId",
			"value": ""
		},
		{
			"key": "regPublicCode",
			"value": ""
		},
		{
			"key": "meAccountId",
			"value": ""
		},
		{
			"key": "meBalancePoints",
			"value": ""
		},
		{
			"key": "meTotalSpendMoney",
			"value": ""
		},
		{
			"key": "meLevelCode",
			"value": ""
		},
		{
			"key": "meAsOf",
			"value": ""
		},
		{
			"key": "meTotalSpendCents",
			"value": ""
		},
		{
			"key": "earnBalanceBefore",
			"value": ""
		},
		{
			"key": "earnSpendBeforeCents",
			"value": ""
		},
		{
			"key": "earnOperationId",
			"value": ""
		},
		{
			"key": "earnAmountMoney",
			"value": ""
		},
		{
			"key": "earnExpectedSpendAfterCents",
			"value": ""
		},
		{
			"key": "earnEventId",
			"value": ""
		},
		{
			"key": "earnBalanceAfter",
			"value": ""
		},
		{
			"key": "spendTopupOperationId",
			"value": ""
		},
		{
			"key": "spendTopupAmountMoney",
			"value": ""
		},
		{
			"key": "spendBalanceAfterTopup",
			"value": ""
		},
		{
			"key": "spendBalanceBefore",
			"value": ""
		},
		{
			"key": "spendTotalSpendBeforeCents",
			"value": ""
		},
		{
			"key": "spendAmountPoints",
			"value": ""
		},
		{
			"key": "spendOperationId",
			"value": ""
		},
		{
			"key": "spendExpectedAfter",
			"value": ""
		},
		{
			"key": "spendEventId",
			"value": ""
		},
		{
			"key": "spendBalanceAfter",
			"value": ""
		},
		{
			"key": "spendTotalSpendAfterCents",
			"value": ""
		},
		{
			"key": "meUserId",
			"value": ""
		},
		{
			"key": "meUserPhone",
			"value": ""
		},
		{
			"key": "mePublicCode",
			"value": ""
		},
		{
			"key": "meBalancePointsFromMe",
			"value": ""
		},
		{
			"key": "meTotalSpendMoneyFromMe",
			"value": ""
		},
		{
			"key": "meLevelCodeFromMe",
			"value": ""
		},
		{
			"key": "meEventsNextBeforeTs",
			"value": ""
		},
		{
			"key": "meEventsFirstId",
			"value": ""
		},
		{
			"key": "meEventsFirstTs",
			"value": ""
		},
		{
			"key": "meEventsPaginationActive",
			"value": ""
		},
		{
			"key": "meEventsBeforeTsParam",
			"value": ""
		},
		{
			"key": "admTmpPhone",
			"value": ""
		},
		{
			"key": "admTmpPassword",
			"value": ""
		},
		{
			"key": "admTmpUserId",
			"value": ""
		},
		{
			"key": "admTmpToken",
			"value": ""
		},
		{
			"key": "adminUsersFirstId",
			"value": ""
		},
		{
			"key": "adminUsersFirstPhone",
			"value": ""
		},
		{
			"key": "adminUsersP1Id",
			"value": ""
		},
		{
			"key": "adminUsersP1Phone",
			"value": ""
		},
		{
			"key": "adminUsersQ",
			"value": ""
		},
		{
			"key": "currentRulesetId",
			"value": ""
		},
		{
			"key": "currentRulesetEffectiveFrom",
			"value": ""
		},
		{
			"key": "currentRulesetBaseRubPerPoint",
			"value": ""
		},
		{
			"key": "currentRulesetCreatedAt",
			"value": ""
		},
		{
			"key": "currentRulesetLevelsCount",
			"value": ""
		},
		{
			"key": "rulesetsFirstId",
			"value": ""
		},
		{
			"key": "rulesetsCount",
			"value": ""
		},
		{
			"key": "rulesetsP1Id",
			"value": ""
		},
		{
			"key": "rsEffectiveFrom",
			"value": ""
		},
		{
			"key": "rsBaseRubPerPoint",
			"value": ""
		},
		{
			"key": "rsCreatedId",
			"value": ""
		}
	]
}