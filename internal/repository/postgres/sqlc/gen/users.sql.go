// ErrCode generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: users.sql

package gen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const createUser = `-- name: CreateUser :one
INSERT INTO users (phone, password_hash)
VALUES ($1, $2)
RETURNING id
`

type CreateUserParams struct {
	Phone        string
	PasswordHash string
}

func (q *Queries) CreateUser(ctx context.Context, db DBTX, arg CreateUserParams) (int64, error) {
	row := db.QueryRow(ctx, createUser, arg.Phone, arg.PasswordHash)
	var id int64
	err := row.Scan(&id)
	return id, err
}

const deactivateUser = `-- name: DeactivateUser :exec
UPDATE users
SET is_active = false
WHERE id = $1
`

func (q *Queries) DeactivateUser(ctx context.Context, db DBTX, id int64) error {
	_, err := db.Exec(ctx, deactivateUser, id)
	return err
}

const getUserByID = `-- name: GetUserByID :one
SELECT id, phone, password_hash, is_active, created_at
FROM users
WHERE id = $1
`

type GetUserByIDRow struct {
	ID           int64
	Phone        string
	PasswordHash string
	IsActive     bool
	CreatedAt    pgtype.Timestamptz
}

func (q *Queries) GetUserByID(ctx context.Context, db DBTX, id int64) (GetUserByIDRow, error) {
	row := db.QueryRow(ctx, getUserByID, id)
	var i GetUserByIDRow
	err := row.Scan(
		&i.ID,
		&i.Phone,
		&i.PasswordHash,
		&i.IsActive,
		&i.CreatedAt,
	)
	return i, err
}

const getUserByPhone = `-- name: GetUserByPhone :one
SELECT id, phone, password_hash, is_active, created_at
FROM users
WHERE phone = $1
`

type GetUserByPhoneRow struct {
	ID           int64
	Phone        string
	PasswordHash string
	IsActive     bool
	CreatedAt    pgtype.Timestamptz
}

func (q *Queries) GetUserByPhone(ctx context.Context, db DBTX, phone string) (GetUserByPhoneRow, error) {
	row := db.QueryRow(ctx, getUserByPhone, phone)
	var i GetUserByPhoneRow
	err := row.Scan(
		&i.ID,
		&i.Phone,
		&i.PasswordHash,
		&i.IsActive,
		&i.CreatedAt,
	)
	return i, err
}

const listUsers = `-- name: ListUsers :many
SELECT id, phone, password_hash, is_active, created_at
FROM users
WHERE ($1::text = '' OR phone ILIKE '%' || $1 || '%')
ORDER BY id DESC
LIMIT $2 OFFSET $3
`

type ListUsersParams struct {
	Column1 string
	Limit   int32
	Offset  int32
}

type ListUsersRow struct {
	ID           int64
	Phone        string
	PasswordHash string
	IsActive     bool
	CreatedAt    pgtype.Timestamptz
}

func (q *Queries) ListUsers(ctx context.Context, db DBTX, arg ListUsersParams) ([]ListUsersRow, error) {
	rows, err := db.Query(ctx, listUsers, arg.Column1, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListUsersRow
	for rows.Next() {
		var i ListUsersRow
		if err := rows.Scan(
			&i.ID,
			&i.Phone,
			&i.PasswordHash,
			&i.IsActive,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
