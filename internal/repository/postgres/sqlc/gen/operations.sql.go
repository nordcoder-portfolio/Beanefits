// ErrCode generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: operations.sql

package gen

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const finalizeOperation = `-- name: FinalizeOperation :exec
UPDATE operations
SET http_status = $4,
    response_json = $5
WHERE account_id = $1
  AND op_type = $2::event_type
  AND operation_id = $3
`

type FinalizeOperationParams struct {
	AccountID    int64
	Column2      EventType
	OperationID  string
	HttpStatus   pgtype.Int4
	ResponseJson []byte
}

func (q *Queries) FinalizeOperation(ctx context.Context, db DBTX, arg FinalizeOperationParams) error {
	_, err := db.Exec(ctx, finalizeOperation,
		arg.AccountID,
		arg.Column2,
		arg.OperationID,
		arg.HttpStatus,
		arg.ResponseJson,
	)
	return err
}

const getOperation = `-- name: GetOperation :one
SELECT
    account_id,
    op_type::text AS op_type,
    operation_id,
    request_json,
    response_json,
    http_status,
    created_at
FROM operations
WHERE account_id = $1
  AND op_type = $2::event_type
  AND operation_id = $3
`

type GetOperationParams struct {
	AccountID   int64
	Column2     EventType
	OperationID string
}

type GetOperationRow struct {
	AccountID    int64
	OpType       string
	OperationID  string
	RequestJson  []byte
	ResponseJson []byte
	HttpStatus   pgtype.Int4
	CreatedAt    pgtype.Timestamptz
}

func (q *Queries) GetOperation(ctx context.Context, db DBTX, arg GetOperationParams) (GetOperationRow, error) {
	row := db.QueryRow(ctx, getOperation, arg.AccountID, arg.Column2, arg.OperationID)
	var i GetOperationRow
	err := row.Scan(
		&i.AccountID,
		&i.OpType,
		&i.OperationID,
		&i.RequestJson,
		&i.ResponseJson,
		&i.HttpStatus,
		&i.CreatedAt,
	)
	return i, err
}

const insertOperationPending = `-- name: InsertOperationPending :execrows
INSERT INTO operations (account_id, op_type, operation_id, request_json)
VALUES ($1, $2::event_type, $3, $4)
ON CONFLICT (account_id, op_type, operation_id) DO NOTHING
`

type InsertOperationPendingParams struct {
	AccountID   int64
	Column2     EventType
	OperationID string
	RequestJson []byte
}

func (q *Queries) InsertOperationPending(ctx context.Context, db DBTX, arg InsertOperationPendingParams) (int64, error) {
	result, err := db.Exec(ctx, insertOperationPending,
		arg.AccountID,
		arg.Column2,
		arg.OperationID,
		arg.RequestJson,
	)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected(), nil
}
